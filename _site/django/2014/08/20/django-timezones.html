<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

<!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Django timezones | Agiliq Blogs</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Django timezones" />
<meta name="author" content="akshar" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This post tries to clear various concepts related to Django timezones. Settings relevant to timezone are TIME_ZONE and USE_TZ. We will see various scenarios with different values for these settings and will figure out how TIME_ZONE and USE_TZ behave. Once through this post, you will stop playing guessing games with Django timezones. I will use sqlite throughout this post. I assume that you understand the general concept of timezone. If not then see the section at bottom before you read further. Installing pytz Working with timezones is much easier if you have pytz installed. Django recommends using it too. pip install pytz Naive and aware datetimes Before you can understand Django timezones, it’s important to understand naive and aware datetimes. Naive datetime Suppose you schedule a Google hangout for 28 July, 6:30 PM with someone. You do not give any timezone information. That person has no way to know if you mean 6:30 PM in India or 6:30 PM in USA. This 6:30 PM is open to interpretation. It is a naive datetime. &gt;&gt;&gt; from datetime import datetime &gt;&gt;&gt; dt = datetime.now() &gt;&gt;&gt; dt datetime.datetime(2014, 7, 29, 12, 55, 20, 672052) &gt;&gt;&gt; print dt.tzinfo None #This prints None. You can check tzinfo attribute on a datetime instance to know if the datetime instance in naive or aware. If tzinfo in None, then it is a naive datetime. Also dt would be same as your computer’s time. Check it using date command on a new terminal. Though system’s datetime has a timezone info associated with current time, Python’s datetime.now() doesn’t give the timezone information by default. ~ $ date Tue Jul 29 12:55:22 IST 2014 Aware datetime If you say 3:30 AM New York time, it is an aware datetime. This 3:30 AM is not open to interpretation. &gt;&gt;&gt; import pytz &gt;&gt;&gt; tz = pytz.timezone(&#39;America/New_York&#39;) &gt;&gt;&gt; new_york_dt = datetime.now(tz) # We pass timezone instance to now() &gt;&gt;&gt; new_york_dt datetime.datetime(2014, 7, 29, 3, 43, 58, 507746, tzinfo=&lt;DstTzInfo &#39;America/New_York&#39; EDT-1 day, 20:00:00 DST&gt;) &gt;&gt;&gt; print new_york_dt.tzinfo America/New_York As you can see tzinfo attribute is set on the datetime instance if we pass a pytz.timezone instance to datetime.now(). Here new_york_dt is an aware datetime instance. You can read Python docs on datetime to know more about naive and aware datetimes. Setting up the project I will try everything inside a virtual environment. My virtualenv is named django_timezone and path is /tmp. (django_timezone)/tmp $ django-admin.py startproject tz I am using Django 1.6.5. Let’s will install pytz too. (django_timezone)/tmp/tz $ pip install pytz Django timezone behaviour depends on settings.USE_TZ and settings.TIME_ZONE. Their default values are: TIME_ZONE = &#39;UTC&#39; USE_TZ = True We need a DateTime field to go through various scenarios. Create an app which will contain a model with a DateTimeField (django_timezone)/tmp/tz $ python manage.py startapp article In article/models.py class Article(models.Model): description = models.TextField() publish_date = models.DateTimeField() Run syncdb, make sure to add ‘article’ to INSTALLED_APPS. Make sure to register Article in admin. Using datetime.now() from shell At this point, we have the following settings TIME_ZONE = &#39;UTC&#39; USE_TZ = True Start a shell. (django_timezone)/private/tmp/tz $ python manage.py shell &gt;&gt;&gt; from datetime import datetime &gt;&gt;&gt; dt = datetime.now() &gt;&gt;&gt; print dt 2014-07-29 09:52:33.417034 I am in India at GMT+05:30 and right now it is 3:22 PM in India. But now() tells me it’s 09:52 AM which is 5 hours 30 minutes behind India’s time. now() is telling the UTC time. And TIME_ZONE is set as ‘UTC’. So, now() uses TIME_ZONE to tell time. But this datetime dt is naive, as you can verify by printing dt.tzinfo. Make USE_TZ = False Make sure to set settings.USE_TZ=False &gt;&gt;&gt; from datetime import datetime &gt;&gt;&gt; dt = datetime.now() &gt;&gt;&gt; print dt 2014-07-29 09:55:49.481732 now() still gives the UTC time. And dt is naive as can be verified by printing dt.tzinfo. This verifies datetime.now() is independent of settings.USE_TZ. It seems it depends on TIME_ZONE. Let’s change settings.TIME_ZONE to ‘America/New_York’ and see if output of now() differs. New York is at UTC-04:00. So now() should start saying 05:55 AM. settings.TIME_ZONE = &#39;America/New_York&#39; Restart the shell and invoke now() &gt;&gt;&gt; from datetime import datetime &gt;&gt;&gt; dt = datetime.now() &gt;&gt;&gt; print dt 2014-07-29 05:58:27.056390 now() tells the current time of New York. This verifies that datetime.now() is dependent on TIME_ZONE. Though this datetime is naive too; verify using dt.tzinfo. Reset TIME_ZONE to ‘UTC’ and USE_TZ to True. Using django.utils.timezone.now() Edit: The striked out lines is what I wrote earlier, but the good folks on reddit corrected me. It behaves similar to datetime.now() with one difference. Where datetime.now() always gives naive datetime object, this gives a naive or aware datetime object depending on value of USE_TZ. It always returns UTC time. It is not dependent on settings.TIME_ZONE. It gives a native or aware datetime object depending on values of settings.USE_TZ When USE_TZ is True &gt;&gt;&gt; from django.utils.timezone import now &gt;&gt;&gt; dt = now() &gt;&gt;&gt; dt datetime.datetime(2014, 7, 29, 10, 22, 24, 163837, tzinfo=&lt;UTC&gt;) &gt;&gt;&gt; print dt.tzinfo UTC This gives the UTC time because we have TIME_ZONE set to UTC. This behaviour is similar to datetime.now(). But in addition, the datetime object also has tzinfo attribute set on it and so it is an aware datetime object. We got an aware datetime object and time is represented in UTC. Verifying that timezone.now() doesn’t depend on TIME_ZONE Change settings.TIME_ZONE TIME_ZONE = &#39;Asia/Kolkata&#39; Restart the shell and use timezone.now() &gt;&gt;&gt; from django.utils.timezone import now &gt;&gt;&gt; dt = now() &gt;&gt;&gt; dt datetime.datetime(2014, 7, 29, 10, 23, 24, 163837, tzinfo=&lt;UTC&gt;) &gt;&gt;&gt; print dt.tzinfo UTC So even though we set timezone as ‘Asia/Kolkata’, now() returns UTC time. When USE_TZ is False Make sure to change settings.USE_TZ=False &gt;&gt;&gt; from django.utils.timezone import now &gt;&gt;&gt; dt = now() &gt;&gt;&gt; dt datetime.datetime(2014, 7, 29, 10, 28, 10, 353942) &gt;&gt;&gt; print dt.tzinfo None This behaviour is exactly similar to datetime.now(). You get the time in same timezone as settings.TIME_ZONE, and it is a naive datetime. Reset USE_TZ to True. Before we proceed When we say timezone support is enabled, it means USE_TZ = True. When we say timezone support is disabled, it means USE_TZ = False. How Article.publish_date behaves in form Let’s first consider the scenario where timezone is enabled. Timezone is enabled, i.e USE_TZ=True Go to article creation page http://localhost:8000/admin/article/article/add/ We are concerned with publish_date. If you click on Today, it will enter the date taken from your system time. When you click on Now, it will enter the time taken from your system time. Today and Now work using Javascript, and Javascript doesn’t have any idea of Django TIME_ZONE and USE_TZ. Javascript only has access to your system time. That’s why Today and Now will take the value from your system’s time irrespective of Django TIME_ZONE and USE_TZ values. I am in India which is at UTC+05:30, and it is 4:13 PM for me. Clicking on Now puts 4:13 PM in my text field, even though I have TIME_ZONE=’UTC’. In ‘UTC’, it is 10:43 AM (4:13 PM - 5 hours 30 minutes) right now. Even though TIME_ZONE is set to ‘UTC’, clicking on Now uses my system time, because Javascript doesn’t have a knowledge of settings.TIME_ZONE Save the article. Check the value of publish_date saved in db. &gt;&gt;&gt; article = Article.objects.get() &gt;&gt;&gt; article.publish_date datetime.datetime(2014, 7, 29, 16, 13, 28, tzinfo=&lt;UTC&gt;) So Django tells that publish_date is a timezone aware object with publish_date being shown as 4:13 PM, UTC. This is a bug, we will see an implication of this bug soon. When I submitted the form, I submitted with the assumption that I am submitting time in India timezone. I expect publish_date to say 4:13 PM, India time(hereafter referred as IST). Or it should say 10:43 AM, UTC. We will see how such scenario should be handled and fix this bug later on in this post. Check how is it saved in db. python manage.py dbshell sqlite&gt; select * from article_article; 1|First Article|2014-07-29 16:13:28 It only tells the time and doesn’t tell anything about timezone. So, db doesn’t save timezone information. Django puts a timezone info on datetime instance based on TIME_ZONE. That’s why we saw article.publish_date in ‘UTC’ timezone. Note: Postgres can save timezone information too. But we will not worry about it in this post. What happened when I submitted publish_date from browser Browser submitted 4:16 PM to server. Browser did not submit any timezone info. Django saves 4:16 PM in db without any timezone info When getting publish date of Article, Django gets 4:16 PM from db, without any timezone info. In addition, Django checks value of TIME_ZONE and so adds tzinfo attribute on publish_date and makes it timezone aware. Timezone is disabled, i.e USE_TZ=False Make sure to modify settings.USE_TZ=False Go to article creation page http://localhost:8000/admin/article/article/add/ You will still see Today and Now buttons picking up the system time. They are in no way dependent on TIME_ZONE and USE_TZ. Create an article from the admin. And then get it and print its publish_date. &gt;&gt;&gt; article = Article.objects.get(id=2) &gt;&gt;&gt; article.publish_date datetime.datetime(2014, 7, 30, 15, 37, 18) We get a naive datetime object in this scenario. Django didn’t add any tzinfo attribute on datetime instance after fetching it from db. Reset USE_TZ to True. Implication of the bug Suppose your project is used by publishers in many countries. Project’s TIME_ZONE is set to ‘UTC’. I am a publisher from India. When I use admin form, I submit date and time in IST. Consider the last article I created. I created the article with publish_date as 3:37 PM, 30th July. My intention was 3:37 PM IST. I expect that article will be shown on the site after 3:37 PM IST. But Django when getting this article from db considers the publish_date as 3:37 PM UTC, because settings.TIME_ZONE is UTC. Placeholder code for view which shows articles. from django.utils.timezone import now current_time = now() Article.objects.filter(publish_date__lte=current_time) When it is 3:38 PM IST, I expect my article to appear on site. But it won’t because when it is 3:38 PM IST, django.utils.timezone.now() will say 10:08 AM UTC. And publish_date is 3:37 PM UTC as per Django, so the filter() will not get my article. Fix for this Django has a concept of default and current timezone. Default timezone and current timezone Default timezone is the timezone defined by settings.TIME_ZONE. Django documentation says, current timezone is the timezone used for rendering. It has an additional purpose and it can fix our buggy scenario. Additional purpose We can say to Django that current timezone is IST. So, when we submit a form, date and time we pass will be considered in IST and then will be converted to default timezone(UTC) and will then be saved in the database. Supposing current timezone is set to IST. I post 3:37 PM. Current timezone is set to IST, we will see how to set current timezone soon. Django will know I mean 3:37 PM, IST. Django will convert 3:37 PM, IST to UTC(because default timezone for project is UTC) And will save converted UTC time in db. Converted UTC time would be 10:07 AM. And our filter condition will work properly. Setting current timezone This can be done using django.utils.timezone.activate Django example uses session and middleware to set timezone. We will use middleware too but instead of bothering with sessions to keep track of user’s timezone, I will hardcode the current timezone. Let’s add a file article/middleware.py with following content: import pytz from django.utils.timezone import activate class TimezoneMiddleware(object): def process_request(self, request): activate(pytz.timezone(&#39;Asia/Kolkata&#39;)) Using activate() sets the current timezone. With our middleware, current timezone is set to IST. Since we are using a middleware, current timezone will be set in every request. Add this middleware to settings.MIDDLEWARE_CLASSES: MIDDLEWARE_CLASSES = ( &#39;article.middleware.TimezoneMiddleware&#39;, &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;, &#39;django.middleware.common.CommonMiddleware&#39;, &#39;django.middleware.csrf.CsrfViewMiddleware&#39;, &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;, &#39;django.contrib.messages.middleware.MessageMiddleware&#39;, &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;, ) Visit Article add page in admin. Enter ‘Date’ for Publish date as ‘2014-07-30’ and ‘Time’ as ‘15:37:08’. Click ‘Save’. Verify how is it saved in db: sqlite&gt; select * from article_article where id=3; 3|Third article|2014-07-30 10:07:18 So, time we submitted was converted to UTC from IST and then saved to db. Why? We submitted 15:37:08 as time. Middleware ran and set the current timezone as IST. Django assumed that the time we submitted was in IST because current timezone was set to IST. Django sees values of TIME_ZONE which is UTC. So it converted the time to UTC and then saved in db. Check how is it shown in admin. See &lt;a href=&quot;http://localhost:8000/admin/article/article/3/&quot; target=&quot;_blank&quot;&gt;article 3 details&lt;/a&gt; Publish Time gets shown as ‘15:37:18’. This is because middleware runs on every request. And our middleware sets the current timezone to IST. So, whatever our site gets from db, is converted to IST and then shown to us, which is perfect. Check how is it shown on shell. (django_timezone)/private/tmp/tz $ python manage.py shell &gt;&gt;&gt; article = Article.objects.get(id=3) &gt;&gt;&gt; article.publish_date datetime.datetime(2014, 7, 30, 10, 7, 18, tzinfo=&lt;UTC&gt;) Django gets the time from db. In db, time is saved as 10:07:18. Django reads the value of TIME_ZONE and sets the TIME_ZONE as tzinfo attribute on datetime object. Can current timezone work if timezone is not activated Set USE_TZ to False. Create a new Article from admin. Set Publish date as 2014-07-30, and publish time as 15:37:18. Save it. Check how is it saved in db. sqlite&gt; select * from article_article where id=4; 4|Fourth article|2014-07-30 15:37:18 So, even though our code tries to set current timezone through middleware, current timezone wasn’t set because we have timezone support disabled. Django didn’t convert our IST time to UTC before saving to db. How is it shown on shell &gt;&gt;&gt; article = Article.objects.get(id=4) &gt;&gt;&gt; article.publish_date datetime.datetime(2014, 7, 30, 15, 37, 18, tzinfo=&lt;UTC&gt;) View the Article 4 details in admin. http://localhost:8000/admin/article/article/4/ Admin shows the publish time same as what was saved in db. No conversion between timezones was done. Reset USE_TZ to True. Notes USE_TZ=True means timezone support is enabled, USE_TZ=False means timezone is not enabled. TIME_ZONE determines in what timezone datetime.now and django.utils.timezone.now return you the time. datetime.now always gives naive datetime objects. django.utils.timezone.now gives naive datetime objects if timezone support is not enabled, and gives aware objects if timezone support is enabled. Current timezone is set using django.utils.timezone.activate. Current timezone activation works only if timezone support is enabled, i.e USE_TZ should be True. When current timezone is enabled, Django converts the datetime you POST into settings.TIME_ZONE and then saves this converted datetime in database. With current timezone enabled, Django converts the datetime it fetches from db into current timezone. Datetime instances with current timezone is displayed in the user facing forms. Concept of timezone Every country is at a different position on Earth and all countries do not face the Sun at the same instant. India and United States are almost on opposite sides of each other on Earth. When India faces the Sun, USA doesn’t face it. At that instant, it is light(day) in India and dark(night) in USA. Earth rotates on its axis. So after few hours, USA would face the Sun and India wouldn’t face it. People want the clock to show between 6 AM to 6 PM during the day and between 6 PM to 6 AM during night. People in India have their clocks set such that it says between 6 AM to 6 PM when India faces the Sun. At the same instant, USA doesn’t face Sun and it is dark there; so people in US have their clocks set such that it shows a time between 6 PM to 6 AM. USA and Indian clocks show different time at the same instant. But India and USA aren’t mathematical terms. There should be a way to know what time is it exactly in USA when it is 6:30 PM, 28 July in India. So we need to know how many hours we need to add or subtract to this time to get the time in USA. This is where timezones come into picture. There is a reference place on Earth relative to which time on other places is calculated. That place is Greenwich. And its timezone is conventionally called GMT + 0:00. GMT and UTC can be used interchangeably. So Greenwich’s timezone is GMT+00:00 or UTC+00:00. India’s timezone is GMT+05:30 or UTC+05:30. When it is 8:00 AM in Greenwich, it is 1:30 PM in India. New York’s timezone is GMT-04:00 during summer. So when it is 8:00 AM in Greenwich, it is 4:00 AM in New York. Whole explanation of timezone is outside the scope of this blog. Read about in on Wikipedia to know more. Resume at top" />
<meta property="og:description" content="This post tries to clear various concepts related to Django timezones. Settings relevant to timezone are TIME_ZONE and USE_TZ. We will see various scenarios with different values for these settings and will figure out how TIME_ZONE and USE_TZ behave. Once through this post, you will stop playing guessing games with Django timezones. I will use sqlite throughout this post. I assume that you understand the general concept of timezone. If not then see the section at bottom before you read further. Installing pytz Working with timezones is much easier if you have pytz installed. Django recommends using it too. pip install pytz Naive and aware datetimes Before you can understand Django timezones, it’s important to understand naive and aware datetimes. Naive datetime Suppose you schedule a Google hangout for 28 July, 6:30 PM with someone. You do not give any timezone information. That person has no way to know if you mean 6:30 PM in India or 6:30 PM in USA. This 6:30 PM is open to interpretation. It is a naive datetime. &gt;&gt;&gt; from datetime import datetime &gt;&gt;&gt; dt = datetime.now() &gt;&gt;&gt; dt datetime.datetime(2014, 7, 29, 12, 55, 20, 672052) &gt;&gt;&gt; print dt.tzinfo None #This prints None. You can check tzinfo attribute on a datetime instance to know if the datetime instance in naive or aware. If tzinfo in None, then it is a naive datetime. Also dt would be same as your computer’s time. Check it using date command on a new terminal. Though system’s datetime has a timezone info associated with current time, Python’s datetime.now() doesn’t give the timezone information by default. ~ $ date Tue Jul 29 12:55:22 IST 2014 Aware datetime If you say 3:30 AM New York time, it is an aware datetime. This 3:30 AM is not open to interpretation. &gt;&gt;&gt; import pytz &gt;&gt;&gt; tz = pytz.timezone(&#39;America/New_York&#39;) &gt;&gt;&gt; new_york_dt = datetime.now(tz) # We pass timezone instance to now() &gt;&gt;&gt; new_york_dt datetime.datetime(2014, 7, 29, 3, 43, 58, 507746, tzinfo=&lt;DstTzInfo &#39;America/New_York&#39; EDT-1 day, 20:00:00 DST&gt;) &gt;&gt;&gt; print new_york_dt.tzinfo America/New_York As you can see tzinfo attribute is set on the datetime instance if we pass a pytz.timezone instance to datetime.now(). Here new_york_dt is an aware datetime instance. You can read Python docs on datetime to know more about naive and aware datetimes. Setting up the project I will try everything inside a virtual environment. My virtualenv is named django_timezone and path is /tmp. (django_timezone)/tmp $ django-admin.py startproject tz I am using Django 1.6.5. Let’s will install pytz too. (django_timezone)/tmp/tz $ pip install pytz Django timezone behaviour depends on settings.USE_TZ and settings.TIME_ZONE. Their default values are: TIME_ZONE = &#39;UTC&#39; USE_TZ = True We need a DateTime field to go through various scenarios. Create an app which will contain a model with a DateTimeField (django_timezone)/tmp/tz $ python manage.py startapp article In article/models.py class Article(models.Model): description = models.TextField() publish_date = models.DateTimeField() Run syncdb, make sure to add ‘article’ to INSTALLED_APPS. Make sure to register Article in admin. Using datetime.now() from shell At this point, we have the following settings TIME_ZONE = &#39;UTC&#39; USE_TZ = True Start a shell. (django_timezone)/private/tmp/tz $ python manage.py shell &gt;&gt;&gt; from datetime import datetime &gt;&gt;&gt; dt = datetime.now() &gt;&gt;&gt; print dt 2014-07-29 09:52:33.417034 I am in India at GMT+05:30 and right now it is 3:22 PM in India. But now() tells me it’s 09:52 AM which is 5 hours 30 minutes behind India’s time. now() is telling the UTC time. And TIME_ZONE is set as ‘UTC’. So, now() uses TIME_ZONE to tell time. But this datetime dt is naive, as you can verify by printing dt.tzinfo. Make USE_TZ = False Make sure to set settings.USE_TZ=False &gt;&gt;&gt; from datetime import datetime &gt;&gt;&gt; dt = datetime.now() &gt;&gt;&gt; print dt 2014-07-29 09:55:49.481732 now() still gives the UTC time. And dt is naive as can be verified by printing dt.tzinfo. This verifies datetime.now() is independent of settings.USE_TZ. It seems it depends on TIME_ZONE. Let’s change settings.TIME_ZONE to ‘America/New_York’ and see if output of now() differs. New York is at UTC-04:00. So now() should start saying 05:55 AM. settings.TIME_ZONE = &#39;America/New_York&#39; Restart the shell and invoke now() &gt;&gt;&gt; from datetime import datetime &gt;&gt;&gt; dt = datetime.now() &gt;&gt;&gt; print dt 2014-07-29 05:58:27.056390 now() tells the current time of New York. This verifies that datetime.now() is dependent on TIME_ZONE. Though this datetime is naive too; verify using dt.tzinfo. Reset TIME_ZONE to ‘UTC’ and USE_TZ to True. Using django.utils.timezone.now() Edit: The striked out lines is what I wrote earlier, but the good folks on reddit corrected me. It behaves similar to datetime.now() with one difference. Where datetime.now() always gives naive datetime object, this gives a naive or aware datetime object depending on value of USE_TZ. It always returns UTC time. It is not dependent on settings.TIME_ZONE. It gives a native or aware datetime object depending on values of settings.USE_TZ When USE_TZ is True &gt;&gt;&gt; from django.utils.timezone import now &gt;&gt;&gt; dt = now() &gt;&gt;&gt; dt datetime.datetime(2014, 7, 29, 10, 22, 24, 163837, tzinfo=&lt;UTC&gt;) &gt;&gt;&gt; print dt.tzinfo UTC This gives the UTC time because we have TIME_ZONE set to UTC. This behaviour is similar to datetime.now(). But in addition, the datetime object also has tzinfo attribute set on it and so it is an aware datetime object. We got an aware datetime object and time is represented in UTC. Verifying that timezone.now() doesn’t depend on TIME_ZONE Change settings.TIME_ZONE TIME_ZONE = &#39;Asia/Kolkata&#39; Restart the shell and use timezone.now() &gt;&gt;&gt; from django.utils.timezone import now &gt;&gt;&gt; dt = now() &gt;&gt;&gt; dt datetime.datetime(2014, 7, 29, 10, 23, 24, 163837, tzinfo=&lt;UTC&gt;) &gt;&gt;&gt; print dt.tzinfo UTC So even though we set timezone as ‘Asia/Kolkata’, now() returns UTC time. When USE_TZ is False Make sure to change settings.USE_TZ=False &gt;&gt;&gt; from django.utils.timezone import now &gt;&gt;&gt; dt = now() &gt;&gt;&gt; dt datetime.datetime(2014, 7, 29, 10, 28, 10, 353942) &gt;&gt;&gt; print dt.tzinfo None This behaviour is exactly similar to datetime.now(). You get the time in same timezone as settings.TIME_ZONE, and it is a naive datetime. Reset USE_TZ to True. Before we proceed When we say timezone support is enabled, it means USE_TZ = True. When we say timezone support is disabled, it means USE_TZ = False. How Article.publish_date behaves in form Let’s first consider the scenario where timezone is enabled. Timezone is enabled, i.e USE_TZ=True Go to article creation page http://localhost:8000/admin/article/article/add/ We are concerned with publish_date. If you click on Today, it will enter the date taken from your system time. When you click on Now, it will enter the time taken from your system time. Today and Now work using Javascript, and Javascript doesn’t have any idea of Django TIME_ZONE and USE_TZ. Javascript only has access to your system time. That’s why Today and Now will take the value from your system’s time irrespective of Django TIME_ZONE and USE_TZ values. I am in India which is at UTC+05:30, and it is 4:13 PM for me. Clicking on Now puts 4:13 PM in my text field, even though I have TIME_ZONE=’UTC’. In ‘UTC’, it is 10:43 AM (4:13 PM - 5 hours 30 minutes) right now. Even though TIME_ZONE is set to ‘UTC’, clicking on Now uses my system time, because Javascript doesn’t have a knowledge of settings.TIME_ZONE Save the article. Check the value of publish_date saved in db. &gt;&gt;&gt; article = Article.objects.get() &gt;&gt;&gt; article.publish_date datetime.datetime(2014, 7, 29, 16, 13, 28, tzinfo=&lt;UTC&gt;) So Django tells that publish_date is a timezone aware object with publish_date being shown as 4:13 PM, UTC. This is a bug, we will see an implication of this bug soon. When I submitted the form, I submitted with the assumption that I am submitting time in India timezone. I expect publish_date to say 4:13 PM, India time(hereafter referred as IST). Or it should say 10:43 AM, UTC. We will see how such scenario should be handled and fix this bug later on in this post. Check how is it saved in db. python manage.py dbshell sqlite&gt; select * from article_article; 1|First Article|2014-07-29 16:13:28 It only tells the time and doesn’t tell anything about timezone. So, db doesn’t save timezone information. Django puts a timezone info on datetime instance based on TIME_ZONE. That’s why we saw article.publish_date in ‘UTC’ timezone. Note: Postgres can save timezone information too. But we will not worry about it in this post. What happened when I submitted publish_date from browser Browser submitted 4:16 PM to server. Browser did not submit any timezone info. Django saves 4:16 PM in db without any timezone info When getting publish date of Article, Django gets 4:16 PM from db, without any timezone info. In addition, Django checks value of TIME_ZONE and so adds tzinfo attribute on publish_date and makes it timezone aware. Timezone is disabled, i.e USE_TZ=False Make sure to modify settings.USE_TZ=False Go to article creation page http://localhost:8000/admin/article/article/add/ You will still see Today and Now buttons picking up the system time. They are in no way dependent on TIME_ZONE and USE_TZ. Create an article from the admin. And then get it and print its publish_date. &gt;&gt;&gt; article = Article.objects.get(id=2) &gt;&gt;&gt; article.publish_date datetime.datetime(2014, 7, 30, 15, 37, 18) We get a naive datetime object in this scenario. Django didn’t add any tzinfo attribute on datetime instance after fetching it from db. Reset USE_TZ to True. Implication of the bug Suppose your project is used by publishers in many countries. Project’s TIME_ZONE is set to ‘UTC’. I am a publisher from India. When I use admin form, I submit date and time in IST. Consider the last article I created. I created the article with publish_date as 3:37 PM, 30th July. My intention was 3:37 PM IST. I expect that article will be shown on the site after 3:37 PM IST. But Django when getting this article from db considers the publish_date as 3:37 PM UTC, because settings.TIME_ZONE is UTC. Placeholder code for view which shows articles. from django.utils.timezone import now current_time = now() Article.objects.filter(publish_date__lte=current_time) When it is 3:38 PM IST, I expect my article to appear on site. But it won’t because when it is 3:38 PM IST, django.utils.timezone.now() will say 10:08 AM UTC. And publish_date is 3:37 PM UTC as per Django, so the filter() will not get my article. Fix for this Django has a concept of default and current timezone. Default timezone and current timezone Default timezone is the timezone defined by settings.TIME_ZONE. Django documentation says, current timezone is the timezone used for rendering. It has an additional purpose and it can fix our buggy scenario. Additional purpose We can say to Django that current timezone is IST. So, when we submit a form, date and time we pass will be considered in IST and then will be converted to default timezone(UTC) and will then be saved in the database. Supposing current timezone is set to IST. I post 3:37 PM. Current timezone is set to IST, we will see how to set current timezone soon. Django will know I mean 3:37 PM, IST. Django will convert 3:37 PM, IST to UTC(because default timezone for project is UTC) And will save converted UTC time in db. Converted UTC time would be 10:07 AM. And our filter condition will work properly. Setting current timezone This can be done using django.utils.timezone.activate Django example uses session and middleware to set timezone. We will use middleware too but instead of bothering with sessions to keep track of user’s timezone, I will hardcode the current timezone. Let’s add a file article/middleware.py with following content: import pytz from django.utils.timezone import activate class TimezoneMiddleware(object): def process_request(self, request): activate(pytz.timezone(&#39;Asia/Kolkata&#39;)) Using activate() sets the current timezone. With our middleware, current timezone is set to IST. Since we are using a middleware, current timezone will be set in every request. Add this middleware to settings.MIDDLEWARE_CLASSES: MIDDLEWARE_CLASSES = ( &#39;article.middleware.TimezoneMiddleware&#39;, &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;, &#39;django.middleware.common.CommonMiddleware&#39;, &#39;django.middleware.csrf.CsrfViewMiddleware&#39;, &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;, &#39;django.contrib.messages.middleware.MessageMiddleware&#39;, &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;, ) Visit Article add page in admin. Enter ‘Date’ for Publish date as ‘2014-07-30’ and ‘Time’ as ‘15:37:08’. Click ‘Save’. Verify how is it saved in db: sqlite&gt; select * from article_article where id=3; 3|Third article|2014-07-30 10:07:18 So, time we submitted was converted to UTC from IST and then saved to db. Why? We submitted 15:37:08 as time. Middleware ran and set the current timezone as IST. Django assumed that the time we submitted was in IST because current timezone was set to IST. Django sees values of TIME_ZONE which is UTC. So it converted the time to UTC and then saved in db. Check how is it shown in admin. See &lt;a href=&quot;http://localhost:8000/admin/article/article/3/&quot; target=&quot;_blank&quot;&gt;article 3 details&lt;/a&gt; Publish Time gets shown as ‘15:37:18’. This is because middleware runs on every request. And our middleware sets the current timezone to IST. So, whatever our site gets from db, is converted to IST and then shown to us, which is perfect. Check how is it shown on shell. (django_timezone)/private/tmp/tz $ python manage.py shell &gt;&gt;&gt; article = Article.objects.get(id=3) &gt;&gt;&gt; article.publish_date datetime.datetime(2014, 7, 30, 10, 7, 18, tzinfo=&lt;UTC&gt;) Django gets the time from db. In db, time is saved as 10:07:18. Django reads the value of TIME_ZONE and sets the TIME_ZONE as tzinfo attribute on datetime object. Can current timezone work if timezone is not activated Set USE_TZ to False. Create a new Article from admin. Set Publish date as 2014-07-30, and publish time as 15:37:18. Save it. Check how is it saved in db. sqlite&gt; select * from article_article where id=4; 4|Fourth article|2014-07-30 15:37:18 So, even though our code tries to set current timezone through middleware, current timezone wasn’t set because we have timezone support disabled. Django didn’t convert our IST time to UTC before saving to db. How is it shown on shell &gt;&gt;&gt; article = Article.objects.get(id=4) &gt;&gt;&gt; article.publish_date datetime.datetime(2014, 7, 30, 15, 37, 18, tzinfo=&lt;UTC&gt;) View the Article 4 details in admin. http://localhost:8000/admin/article/article/4/ Admin shows the publish time same as what was saved in db. No conversion between timezones was done. Reset USE_TZ to True. Notes USE_TZ=True means timezone support is enabled, USE_TZ=False means timezone is not enabled. TIME_ZONE determines in what timezone datetime.now and django.utils.timezone.now return you the time. datetime.now always gives naive datetime objects. django.utils.timezone.now gives naive datetime objects if timezone support is not enabled, and gives aware objects if timezone support is enabled. Current timezone is set using django.utils.timezone.activate. Current timezone activation works only if timezone support is enabled, i.e USE_TZ should be True. When current timezone is enabled, Django converts the datetime you POST into settings.TIME_ZONE and then saves this converted datetime in database. With current timezone enabled, Django converts the datetime it fetches from db into current timezone. Datetime instances with current timezone is displayed in the user facing forms. Concept of timezone Every country is at a different position on Earth and all countries do not face the Sun at the same instant. India and United States are almost on opposite sides of each other on Earth. When India faces the Sun, USA doesn’t face it. At that instant, it is light(day) in India and dark(night) in USA. Earth rotates on its axis. So after few hours, USA would face the Sun and India wouldn’t face it. People want the clock to show between 6 AM to 6 PM during the day and between 6 PM to 6 AM during night. People in India have their clocks set such that it says between 6 AM to 6 PM when India faces the Sun. At the same instant, USA doesn’t face Sun and it is dark there; so people in US have their clocks set such that it shows a time between 6 PM to 6 AM. USA and Indian clocks show different time at the same instant. But India and USA aren’t mathematical terms. There should be a way to know what time is it exactly in USA when it is 6:30 PM, 28 July in India. So we need to know how many hours we need to add or subtract to this time to get the time in USA. This is where timezones come into picture. There is a reference place on Earth relative to which time on other places is calculated. That place is Greenwich. And its timezone is conventionally called GMT + 0:00. GMT and UTC can be used interchangeably. So Greenwich’s timezone is GMT+00:00 or UTC+00:00. India’s timezone is GMT+05:30 or UTC+05:30. When it is 8:00 AM in Greenwich, it is 1:30 PM in India. New York’s timezone is GMT-04:00 during summer. So when it is 8:00 AM in Greenwich, it is 4:00 AM in New York. Whole explanation of timezone is outside the scope of this blog. Read about in on Wikipedia to know more. Resume at top" />
<link rel="canonical" href="http://localhost:4000/django/2014/08/20/django-timezones.html" />
<meta property="og:url" content="http://localhost:4000/django/2014/08/20/django-timezones.html" />
<meta property="og:site_name" content="Agiliq Blogs" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-08-20T10:30:01+05:30" />
<script type="application/ld+json">
{"description":"This post tries to clear various concepts related to Django timezones. Settings relevant to timezone are TIME_ZONE and USE_TZ. We will see various scenarios with different values for these settings and will figure out how TIME_ZONE and USE_TZ behave. Once through this post, you will stop playing guessing games with Django timezones. I will use sqlite throughout this post. I assume that you understand the general concept of timezone. If not then see the section at bottom before you read further. Installing pytz Working with timezones is much easier if you have pytz installed. Django recommends using it too. pip install pytz Naive and aware datetimes Before you can understand Django timezones, it’s important to understand naive and aware datetimes. Naive datetime Suppose you schedule a Google hangout for 28 July, 6:30 PM with someone. You do not give any timezone information. That person has no way to know if you mean 6:30 PM in India or 6:30 PM in USA. This 6:30 PM is open to interpretation. It is a naive datetime. &gt;&gt;&gt; from datetime import datetime &gt;&gt;&gt; dt = datetime.now() &gt;&gt;&gt; dt datetime.datetime(2014, 7, 29, 12, 55, 20, 672052) &gt;&gt;&gt; print dt.tzinfo None #This prints None. You can check tzinfo attribute on a datetime instance to know if the datetime instance in naive or aware. If tzinfo in None, then it is a naive datetime. Also dt would be same as your computer’s time. Check it using date command on a new terminal. Though system’s datetime has a timezone info associated with current time, Python’s datetime.now() doesn’t give the timezone information by default. ~ $ date Tue Jul 29 12:55:22 IST 2014 Aware datetime If you say 3:30 AM New York time, it is an aware datetime. This 3:30 AM is not open to interpretation. &gt;&gt;&gt; import pytz &gt;&gt;&gt; tz = pytz.timezone(&#39;America/New_York&#39;) &gt;&gt;&gt; new_york_dt = datetime.now(tz) # We pass timezone instance to now() &gt;&gt;&gt; new_york_dt datetime.datetime(2014, 7, 29, 3, 43, 58, 507746, tzinfo=&lt;DstTzInfo &#39;America/New_York&#39; EDT-1 day, 20:00:00 DST&gt;) &gt;&gt;&gt; print new_york_dt.tzinfo America/New_York As you can see tzinfo attribute is set on the datetime instance if we pass a pytz.timezone instance to datetime.now(). Here new_york_dt is an aware datetime instance. You can read Python docs on datetime to know more about naive and aware datetimes. Setting up the project I will try everything inside a virtual environment. My virtualenv is named django_timezone and path is /tmp. (django_timezone)/tmp $ django-admin.py startproject tz I am using Django 1.6.5. Let’s will install pytz too. (django_timezone)/tmp/tz $ pip install pytz Django timezone behaviour depends on settings.USE_TZ and settings.TIME_ZONE. Their default values are: TIME_ZONE = &#39;UTC&#39; USE_TZ = True We need a DateTime field to go through various scenarios. Create an app which will contain a model with a DateTimeField (django_timezone)/tmp/tz $ python manage.py startapp article In article/models.py class Article(models.Model): description = models.TextField() publish_date = models.DateTimeField() Run syncdb, make sure to add ‘article’ to INSTALLED_APPS. Make sure to register Article in admin. Using datetime.now() from shell At this point, we have the following settings TIME_ZONE = &#39;UTC&#39; USE_TZ = True Start a shell. (django_timezone)/private/tmp/tz $ python manage.py shell &gt;&gt;&gt; from datetime import datetime &gt;&gt;&gt; dt = datetime.now() &gt;&gt;&gt; print dt 2014-07-29 09:52:33.417034 I am in India at GMT+05:30 and right now it is 3:22 PM in India. But now() tells me it’s 09:52 AM which is 5 hours 30 minutes behind India’s time. now() is telling the UTC time. And TIME_ZONE is set as ‘UTC’. So, now() uses TIME_ZONE to tell time. But this datetime dt is naive, as you can verify by printing dt.tzinfo. Make USE_TZ = False Make sure to set settings.USE_TZ=False &gt;&gt;&gt; from datetime import datetime &gt;&gt;&gt; dt = datetime.now() &gt;&gt;&gt; print dt 2014-07-29 09:55:49.481732 now() still gives the UTC time. And dt is naive as can be verified by printing dt.tzinfo. This verifies datetime.now() is independent of settings.USE_TZ. It seems it depends on TIME_ZONE. Let’s change settings.TIME_ZONE to ‘America/New_York’ and see if output of now() differs. New York is at UTC-04:00. So now() should start saying 05:55 AM. settings.TIME_ZONE = &#39;America/New_York&#39; Restart the shell and invoke now() &gt;&gt;&gt; from datetime import datetime &gt;&gt;&gt; dt = datetime.now() &gt;&gt;&gt; print dt 2014-07-29 05:58:27.056390 now() tells the current time of New York. This verifies that datetime.now() is dependent on TIME_ZONE. Though this datetime is naive too; verify using dt.tzinfo. Reset TIME_ZONE to ‘UTC’ and USE_TZ to True. Using django.utils.timezone.now() Edit: The striked out lines is what I wrote earlier, but the good folks on reddit corrected me. It behaves similar to datetime.now() with one difference. Where datetime.now() always gives naive datetime object, this gives a naive or aware datetime object depending on value of USE_TZ. It always returns UTC time. It is not dependent on settings.TIME_ZONE. It gives a native or aware datetime object depending on values of settings.USE_TZ When USE_TZ is True &gt;&gt;&gt; from django.utils.timezone import now &gt;&gt;&gt; dt = now() &gt;&gt;&gt; dt datetime.datetime(2014, 7, 29, 10, 22, 24, 163837, tzinfo=&lt;UTC&gt;) &gt;&gt;&gt; print dt.tzinfo UTC This gives the UTC time because we have TIME_ZONE set to UTC. This behaviour is similar to datetime.now(). But in addition, the datetime object also has tzinfo attribute set on it and so it is an aware datetime object. We got an aware datetime object and time is represented in UTC. Verifying that timezone.now() doesn’t depend on TIME_ZONE Change settings.TIME_ZONE TIME_ZONE = &#39;Asia/Kolkata&#39; Restart the shell and use timezone.now() &gt;&gt;&gt; from django.utils.timezone import now &gt;&gt;&gt; dt = now() &gt;&gt;&gt; dt datetime.datetime(2014, 7, 29, 10, 23, 24, 163837, tzinfo=&lt;UTC&gt;) &gt;&gt;&gt; print dt.tzinfo UTC So even though we set timezone as ‘Asia/Kolkata’, now() returns UTC time. When USE_TZ is False Make sure to change settings.USE_TZ=False &gt;&gt;&gt; from django.utils.timezone import now &gt;&gt;&gt; dt = now() &gt;&gt;&gt; dt datetime.datetime(2014, 7, 29, 10, 28, 10, 353942) &gt;&gt;&gt; print dt.tzinfo None This behaviour is exactly similar to datetime.now(). You get the time in same timezone as settings.TIME_ZONE, and it is a naive datetime. Reset USE_TZ to True. Before we proceed When we say timezone support is enabled, it means USE_TZ = True. When we say timezone support is disabled, it means USE_TZ = False. How Article.publish_date behaves in form Let’s first consider the scenario where timezone is enabled. Timezone is enabled, i.e USE_TZ=True Go to article creation page http://localhost:8000/admin/article/article/add/ We are concerned with publish_date. If you click on Today, it will enter the date taken from your system time. When you click on Now, it will enter the time taken from your system time. Today and Now work using Javascript, and Javascript doesn’t have any idea of Django TIME_ZONE and USE_TZ. Javascript only has access to your system time. That’s why Today and Now will take the value from your system’s time irrespective of Django TIME_ZONE and USE_TZ values. I am in India which is at UTC+05:30, and it is 4:13 PM for me. Clicking on Now puts 4:13 PM in my text field, even though I have TIME_ZONE=’UTC’. In ‘UTC’, it is 10:43 AM (4:13 PM - 5 hours 30 minutes) right now. Even though TIME_ZONE is set to ‘UTC’, clicking on Now uses my system time, because Javascript doesn’t have a knowledge of settings.TIME_ZONE Save the article. Check the value of publish_date saved in db. &gt;&gt;&gt; article = Article.objects.get() &gt;&gt;&gt; article.publish_date datetime.datetime(2014, 7, 29, 16, 13, 28, tzinfo=&lt;UTC&gt;) So Django tells that publish_date is a timezone aware object with publish_date being shown as 4:13 PM, UTC. This is a bug, we will see an implication of this bug soon. When I submitted the form, I submitted with the assumption that I am submitting time in India timezone. I expect publish_date to say 4:13 PM, India time(hereafter referred as IST). Or it should say 10:43 AM, UTC. We will see how such scenario should be handled and fix this bug later on in this post. Check how is it saved in db. python manage.py dbshell sqlite&gt; select * from article_article; 1|First Article|2014-07-29 16:13:28 It only tells the time and doesn’t tell anything about timezone. So, db doesn’t save timezone information. Django puts a timezone info on datetime instance based on TIME_ZONE. That’s why we saw article.publish_date in ‘UTC’ timezone. Note: Postgres can save timezone information too. But we will not worry about it in this post. What happened when I submitted publish_date from browser Browser submitted 4:16 PM to server. Browser did not submit any timezone info. Django saves 4:16 PM in db without any timezone info When getting publish date of Article, Django gets 4:16 PM from db, without any timezone info. In addition, Django checks value of TIME_ZONE and so adds tzinfo attribute on publish_date and makes it timezone aware. Timezone is disabled, i.e USE_TZ=False Make sure to modify settings.USE_TZ=False Go to article creation page http://localhost:8000/admin/article/article/add/ You will still see Today and Now buttons picking up the system time. They are in no way dependent on TIME_ZONE and USE_TZ. Create an article from the admin. And then get it and print its publish_date. &gt;&gt;&gt; article = Article.objects.get(id=2) &gt;&gt;&gt; article.publish_date datetime.datetime(2014, 7, 30, 15, 37, 18) We get a naive datetime object in this scenario. Django didn’t add any tzinfo attribute on datetime instance after fetching it from db. Reset USE_TZ to True. Implication of the bug Suppose your project is used by publishers in many countries. Project’s TIME_ZONE is set to ‘UTC’. I am a publisher from India. When I use admin form, I submit date and time in IST. Consider the last article I created. I created the article with publish_date as 3:37 PM, 30th July. My intention was 3:37 PM IST. I expect that article will be shown on the site after 3:37 PM IST. But Django when getting this article from db considers the publish_date as 3:37 PM UTC, because settings.TIME_ZONE is UTC. Placeholder code for view which shows articles. from django.utils.timezone import now current_time = now() Article.objects.filter(publish_date__lte=current_time) When it is 3:38 PM IST, I expect my article to appear on site. But it won’t because when it is 3:38 PM IST, django.utils.timezone.now() will say 10:08 AM UTC. And publish_date is 3:37 PM UTC as per Django, so the filter() will not get my article. Fix for this Django has a concept of default and current timezone. Default timezone and current timezone Default timezone is the timezone defined by settings.TIME_ZONE. Django documentation says, current timezone is the timezone used for rendering. It has an additional purpose and it can fix our buggy scenario. Additional purpose We can say to Django that current timezone is IST. So, when we submit a form, date and time we pass will be considered in IST and then will be converted to default timezone(UTC) and will then be saved in the database. Supposing current timezone is set to IST. I post 3:37 PM. Current timezone is set to IST, we will see how to set current timezone soon. Django will know I mean 3:37 PM, IST. Django will convert 3:37 PM, IST to UTC(because default timezone for project is UTC) And will save converted UTC time in db. Converted UTC time would be 10:07 AM. And our filter condition will work properly. Setting current timezone This can be done using django.utils.timezone.activate Django example uses session and middleware to set timezone. We will use middleware too but instead of bothering with sessions to keep track of user’s timezone, I will hardcode the current timezone. Let’s add a file article/middleware.py with following content: import pytz from django.utils.timezone import activate class TimezoneMiddleware(object): def process_request(self, request): activate(pytz.timezone(&#39;Asia/Kolkata&#39;)) Using activate() sets the current timezone. With our middleware, current timezone is set to IST. Since we are using a middleware, current timezone will be set in every request. Add this middleware to settings.MIDDLEWARE_CLASSES: MIDDLEWARE_CLASSES = ( &#39;article.middleware.TimezoneMiddleware&#39;, &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;, &#39;django.middleware.common.CommonMiddleware&#39;, &#39;django.middleware.csrf.CsrfViewMiddleware&#39;, &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;, &#39;django.contrib.messages.middleware.MessageMiddleware&#39;, &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;, ) Visit Article add page in admin. Enter ‘Date’ for Publish date as ‘2014-07-30’ and ‘Time’ as ‘15:37:08’. Click ‘Save’. Verify how is it saved in db: sqlite&gt; select * from article_article where id=3; 3|Third article|2014-07-30 10:07:18 So, time we submitted was converted to UTC from IST and then saved to db. Why? We submitted 15:37:08 as time. Middleware ran and set the current timezone as IST. Django assumed that the time we submitted was in IST because current timezone was set to IST. Django sees values of TIME_ZONE which is UTC. So it converted the time to UTC and then saved in db. Check how is it shown in admin. See &lt;a href=&quot;http://localhost:8000/admin/article/article/3/&quot; target=&quot;_blank&quot;&gt;article 3 details&lt;/a&gt; Publish Time gets shown as ‘15:37:18’. This is because middleware runs on every request. And our middleware sets the current timezone to IST. So, whatever our site gets from db, is converted to IST and then shown to us, which is perfect. Check how is it shown on shell. (django_timezone)/private/tmp/tz $ python manage.py shell &gt;&gt;&gt; article = Article.objects.get(id=3) &gt;&gt;&gt; article.publish_date datetime.datetime(2014, 7, 30, 10, 7, 18, tzinfo=&lt;UTC&gt;) Django gets the time from db. In db, time is saved as 10:07:18. Django reads the value of TIME_ZONE and sets the TIME_ZONE as tzinfo attribute on datetime object. Can current timezone work if timezone is not activated Set USE_TZ to False. Create a new Article from admin. Set Publish date as 2014-07-30, and publish time as 15:37:18. Save it. Check how is it saved in db. sqlite&gt; select * from article_article where id=4; 4|Fourth article|2014-07-30 15:37:18 So, even though our code tries to set current timezone through middleware, current timezone wasn’t set because we have timezone support disabled. Django didn’t convert our IST time to UTC before saving to db. How is it shown on shell &gt;&gt;&gt; article = Article.objects.get(id=4) &gt;&gt;&gt; article.publish_date datetime.datetime(2014, 7, 30, 15, 37, 18, tzinfo=&lt;UTC&gt;) View the Article 4 details in admin. http://localhost:8000/admin/article/article/4/ Admin shows the publish time same as what was saved in db. No conversion between timezones was done. Reset USE_TZ to True. Notes USE_TZ=True means timezone support is enabled, USE_TZ=False means timezone is not enabled. TIME_ZONE determines in what timezone datetime.now and django.utils.timezone.now return you the time. datetime.now always gives naive datetime objects. django.utils.timezone.now gives naive datetime objects if timezone support is not enabled, and gives aware objects if timezone support is enabled. Current timezone is set using django.utils.timezone.activate. Current timezone activation works only if timezone support is enabled, i.e USE_TZ should be True. When current timezone is enabled, Django converts the datetime you POST into settings.TIME_ZONE and then saves this converted datetime in database. With current timezone enabled, Django converts the datetime it fetches from db into current timezone. Datetime instances with current timezone is displayed in the user facing forms. Concept of timezone Every country is at a different position on Earth and all countries do not face the Sun at the same instant. India and United States are almost on opposite sides of each other on Earth. When India faces the Sun, USA doesn’t face it. At that instant, it is light(day) in India and dark(night) in USA. Earth rotates on its axis. So after few hours, USA would face the Sun and India wouldn’t face it. People want the clock to show between 6 AM to 6 PM during the day and between 6 PM to 6 AM during night. People in India have their clocks set such that it says between 6 AM to 6 PM when India faces the Sun. At the same instant, USA doesn’t face Sun and it is dark there; so people in US have their clocks set such that it shows a time between 6 PM to 6 AM. USA and Indian clocks show different time at the same instant. But India and USA aren’t mathematical terms. There should be a way to know what time is it exactly in USA when it is 6:30 PM, 28 July in India. So we need to know how many hours we need to add or subtract to this time to get the time in USA. This is where timezones come into picture. There is a reference place on Earth relative to which time on other places is calculated. That place is Greenwich. And its timezone is conventionally called GMT + 0:00. GMT and UTC can be used interchangeably. So Greenwich’s timezone is GMT+00:00 or UTC+00:00. India’s timezone is GMT+05:30 or UTC+05:30. When it is 8:00 AM in Greenwich, it is 1:30 PM in India. New York’s timezone is GMT-04:00 during summer. So when it is 8:00 AM in Greenwich, it is 4:00 AM in New York. Whole explanation of timezone is outside the scope of this blog. Read about in on Wikipedia to know more. Resume at top","author":{"@type":"Person","name":"akshar"},"@type":"BlogPosting","url":"http://localhost:4000/django/2014/08/20/django-timezones.html","headline":"Django timezones","dateModified":"2014-08-20T10:30:01+05:30","datePublished":"2014-08-20T10:30:01+05:30","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/django/2014/08/20/django-timezones.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="/assets/js/respond.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/assets/css/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <script>
    	function onPageLoad() {
    		var element = document.getElementById("content");
    		var childNodes = element.childElementCount;
    		if(childNodes > 0) {
    		 	element.scrollIntoView(); 
    	 	}

    	}
    </script>
    
  </head>
  <body onload="onPageLoad()"> 
      <div id="header">
        <nav>
          <li class="fork"><a href="">View On GitHub</a></li>
          <!-- 
            <li class="downloads"><a href="">ZIP</a></li>
            <li class="downloads"><a href="">TAR</a></li>
            <li class="title">DOWNLOADS</li>
           -->
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Agiliq Blogs</h1>
          <!-- <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p> -->
          <hr>
          <span class="credits left">Project maintained by <a href="">Agiliq</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
          <ul>
		  
		  <li>
		    <a href="/python/2018/01/21/prime-number-binary-trex.html" >Finding a prime number whose binary representation is a giraffe (or a T-Rex)</a>
		  </li>
		  
		  <li>
		    <a href="/django/2017/12/29/when-and-how-use-django-listview.html" >When and how to use Django ListView</a>
		  </li>
		  
		  <li>
		    <a href="/django/2017/12/29/when-and-how-use-django-templateview.html" >When and how to use Django TemplateView</a>
		  </li>
		  
		  <li>
		    <a href="/django/2017/12/11/adventures-in-advanced-django-orm-with-hyperloglog.html" >Adventures in advanced Django ORM with HyperLogLog</a>
		  </li>
		  
		  <li>
		    <a href="/django/2017/12/06/django-20-window-expressions-tutorial.html" >Django 2.0 Window expressions tutorial</a>
		  </li>
		  
		  <li>
		    <a href="/django/2017/12/02/configure-django-log-exceptions-production.html" >Configure Django to log exceptions in production</a>
		  </li>
		  
		  <li>
		    <a href="/gunicorn/2017/11/15/how-performant-your-python-web-application.html" >How performant is your Python web application</a>
		  </li>
		  
		  <li>
		    <a href="/python/2017/11/01/how-python-generators-are-similar-iterators.html" >How Python generators are similar to iterators</a>
		  </li>
		  
		  <li>
		    <a href="/python/2017/10/18/real-world-usage-iterators-and-iterables.html" >Real world usage of __iter__ and next</a>
		  </li>
		  
		  <li>
		    <a href="/python/2017/10/12/iterators-and-iterables.html" >Iterators and Iterables</a>
		  </li>
		  
		  <li>
		    <a href="/appengine/2017/09/04/getting-started-webapp2-and-gae.html" >Getting started with webapp2 and GAE</a>
		  </li>
		  
		  <li>
		    <a href="/angularjs/2017/04/30/why-angularjs-services-arent-available-configurati.html" >Why AngularJS services aren't available in configuration blocks</a>
		  </li>
		  
		  <li>
		    <a href="/angularjs/2017/04/27/what-when-and-how-angularjs-configuration-blocks.html" >What, when and how of AngularJS configuration blocks</a>
		  </li>
		  
		  <li>
		    <a href="/2017/04/26/trsfer-files-amzon-s3-using-browser-instead-server.html" >Transfer files to amazon s3 using browser instead of server</a>
		  </li>
		  
		  <li>
		    <a href="/angularjs/2017/04/25/angularjs-injectors-internals.html" >AngularJS injectors internals</a>
		  </li>
		  
		  <li>
		    <a href="/angularjs/2017/04/21/how-script-ordering-works-angular-app.html" >How script ordering works in an Angular app</a>
		  </li>
		  
		  <li>
		    <a href="/scrapy/2016/04/02/getting-started-with-python-scrapy.html" >Getting started with python scrapy</a>
		  </li>
		  
		  <li>
		    <a href="/celery/2015/08/03/retrying-celery-failed-tasks.html" >Retrying celery failed tasks</a>
		  </li>
		  
		  <li>
		    <a href="/middlewares/2015/07/17/profiling-django-middlewares.html" >Profiling Django Middlewares</a>
		  </li>
		  
		  <li>
		    <a href="/middlewares/2015/07/17/understanding-django-middlewares.html" >Understanding Django Middlewares</a>
		  </li>
		  
		  <li>
		    <a href="/redis/2015/07/06/getting-started-with-celery-and-redis.html" >Getting started with Celery and Redis</a>
		  </li>
		  
		  <li>
		    <a href="/django-tastypie/2015/03/29/tastypie-with-foreignkey.html" >Tastypie with ForeignKey</a>
		  </li>
		  
		  <li>
		    <a href="/redis/2015/03/26/getting-started-with-redis-py.html" >Getting started with redis-py</a>
		  </li>
		  
		  <li>
		    <a href="/django-tastypie/2015/03/23/getting-started-with-django-tastypie.html" >Getting started with Django tastypie</a>
		  </li>
		  
		  <li>
		    <a href="/google/2015/03/04/building-chrome-extensions.html" >Building Chrome Extensions</a>
		  </li>
		  
		  <li>
		    <a href="/disqus/2015/01/16/importing-your-old-comments-to-disqus-site.html" >Importing your old comments to Disqus site</a>
		  </li>
		  
		  <li>
		    <a href="/python/2014/12/08/how-not-knowing-encoding-can-trip-you.html" >How not knowing encoding can trip you</a>
		  </li>
		  
		  <li>
		    <a href="/python/2014/12/08/understanding-python-unicode-str-unicodeencodeerro.html" >Understanding Python unicode, str, UnicodeEncodeError and UnicodeDecodeError</a>
		  </li>
		  
		  <li>
		    <a href="/api/2014/12/04/building-a-restful-api-with-django-rest-framework.html" >Building a RESTful API with Django-rest-framework</a>
		  </li>
		  
		  <li>
		    <a href="/encoding/2014/11/19/character-encoding-and-unicode.html" >Character encoding and Unicode</a>
		  </li>
		  
		  <li>
		    <a href="/disqus/2014/11/17/disqus-and-disqus-sso.html" >Disqus and Disqus SSO</a>
		  </li>
		  
		  <li>
		    <a href="/http/client/2014/09/08/using-postman.html" >Using a Postman http client for efficient HTTP testing</a>
		  </li>
		  
		  <li>
		    <a href="/functional-testing/2014/09/02/advanced-functional-testing-with-selenium.html" >Advanced functional testing with Selenium in Django</a>
		  </li>
		  
		  <li>
		    <a href="/functional-testing/2014/09/01/selenium-testing.html" >Introduction to functional testing with Selenium in Django</a>
		  </li>
		  
		  <li>
		    <a href="/coveralls.io/2014/08/22/travis-and-coveralls-for-private-repo.html" >Travis and coveralls for private repo</a>
		  </li>
		  
		  <li>
		    <a href="/django/2014/08/20/django-timezones.html" >Django timezones</a>
		  </li>
		  
		  <li>
		    <a href="/django/app/deployment/2014/08/06/deploying-a-django-app-on-amazon-ec2-instance.html" >Deploying a Django app on Amazon EC2 instance.</a>
		  </li>
		  
		  <li>
		    <a href="/django/2014/08/05/passing-parameters-to-django-admin-action.html" >Passing parameters to Django admin action</a>
		  </li>
		  
		  <li>
		    <a href="/python/2014/07/15/method-decorators-in-python.html" >Method decorators in Python</a>
		  </li>
		  
		  <li>
		    <a href="/gunicorn/2014/06/05/minimal-gunicorn-configuration.html" >Minimal Gunicorn configuration</a>
		  </li>
		  
		  <li>
		    <a href="/heroku/2014/06/05/heroku-django-s3-for-serving-media-files.html" >Heroku Django S3 for serving Media files</a>
		  </li>
		  
		  <li>
		    <a href="/mysqltopostgres/2014/05/27/migrating-django-app-from-mysql-to-postgres.html" >Migrating django app from MySQL to Postgres</a>
		  </li>
		  
		  <li>
		    <a href="/google/2014/05/09/google-diff-match-patch-library.html" >Google diff match patch library</a>
		  </li>
		  
		  <li>
		    <a href="/supervisor/2014/05/09/supervisor-with-django-and-gunicorn.html" >Supervisor with Django and Gunicorn</a>
		  </li>
		  
		  <li>
		    <a href="/python/2014/05/05/python-requests.html" >Python-requests</a>
		  </li>
		  
		  <li>
		    <a href="/python/2014/05/01/three-underutilized-python-commands.html" >Three underutilized python commands</a>
		  </li>
		  
		  <li>
		    <a href="/travis/2014/05/01/continuous-integration-with-travis-and-coverallsio.html" >Continuous integration with travis and coveralls.io for Django apps</a>
		  </li>
		  
		  <li>
		    <a href="/django/2014/04/28/django-backward-relationship-lookup.html" >Django backward relationship lookup</a>
		  </li>
		  
		  <li>
		    <a href="/threads/2013/10/17/producer-consumer-problem-in-python.html" >Producer-consumer problem in Python</a>
		  </li>
		  
		  <li>
		    <a href="/design/pattern/2013/10/14/state-pattern-with-ui-code.html" >State pattern with UI Code</a>
		  </li>
		  
		  <li>
		    <a href="/threads/2013/09/17/understanding-threads-in-python.html" >Understanding Threads in Python</a>
		  </li>
		  
		  <li>
		    <a href="/process/2013/09/11/process-and-threads-for-beginners.html" >Process and Threads for Beginners</a>
		  </li>
		  
		  <li>
		    <a href="/nginx/2013/08/26/minimal-nginx-and-gunicorn-configuration-for-djang.html" >Minimal Nginx and Gunicorn configuration for Django projects</a>
		  </li>
		  
		  <li>
		    <a href="/threads/2013/08/21/writing-thread-safe-django-code.html" >Writing thread-safe django - get_or_create</a>
		  </li>
		  
		  <li>
		    <a href="/python/2013/07/12/accept-bitcoins-using-python.html" >Accept bitcoins using python</a>
		  </li>
		  
		  <li>
		    <a href="/python/2013/07/01/basics-wsgi.html" >Basics of WSGI</a>
		  </li>
		  
		  <li>
		    <a href="/docker/2013/06/28/self-testing-fabfile-using-docker.html" >Self-testing fabfile using docker</a>
		  </li>
		  
		  <li>
		    <a href="/docker/2013/06/14/deploying-django-using-docker.html" >Deploying django using docker</a>
		  </li>
		  
		  <li>
		    <a href="/testing/2013/04/28/common-testing-scenarios-for-django-app.html" >Common testing scenarios for Django app.</a>
		  </li>
		  
		  <li>
		    <a href="/static/2013/03/21/serving-static-files-in-django.html" >Serving static files in Django</a>
		  </li>
		  
		  <li>
		    <a href="/book/2013/02/11/two-scoops-of-django-review.html" >Two Scoops of Django: Review</a>
		  </li>
		  
		  <li>
		    <a href="/training/2013/02/08/introduction-to-python-workshop-on-february-15th-2.html" >Introduction to Python Workshop on February 15th, 2013</a>
		  </li>
		  
		  <li>
		    <a href="/django/2013/02/07/easy-client-side-form-validations-for-django-djang.html" >Easy client side form validations for Django: Django Parsley</a>
		  </li>
		  
		  <li>
		    <a href="/open-source/2013/01/21/moreapps-android-library-project-open-sourced.html" >MoreApps - Android Library Project: Open Sourced</a>
		  </li>
		  
		  <li>
		    <a href="/open-source/2013/01/15/password-generetor-app-open-sourced.html" >Password Generator App: Open Sourced</a>
		  </li>
		  
		  <li>
		    <a href="/open-source/2013/01/14/todo-list-app-open-sourced.html" >Todo List App: Open Sourced</a>
		  </li>
		  
		  <li>
		    <a href="/android/2013/01/01/android-fragments-101.html" >Android Fragments 101</a>
		  </li>
		  
		  <li>
		    <a href="/function/as/objects/2012/11/17/understanding-decorators-2.html" >Understanding decorators</a>
		  </li>
		  
		  <li>
		    <a href="/forms/2012/11/07/not-exactly-not-exactly-tim-the-enchanter.html" >Not exactly, not exactly tim the enchanter</a>
		  </li>
		  
		  <li>
		    <a href="/internals/2012/11/01/the-missing-documentation-for-djangoutilsdatastruc.html" >The missing documentation for django.utils.datastructures</a>
		  </li>
		  
		  <li>
		    <a href="/2012/09/06/dissecting-phonegaps-architecture.html" >Dissecting Phonegaps Architecture</a>
		  </li>
		  
		  <li>
		    <a href="/upload/2012/07/17/dropbox-file-upload-handler-for-django.html" >Dropbox file upload handler for django</a>
		  </li>
		  
		  <li>
		    <a href="/virtualization/2012/07/16/using-ubuntu-cloud-images-in-kvm.html" >Using Ubuntu cloud images in KVM</a>
		  </li>
		  
		  <li>
		    <a href="/metaclass/2012/07/02/metaclass-python.html" >Metaclass in Python</a>
		  </li>
		  
		  <li>
		    <a href="/virtualization/2012/06/25/libvirt-and-kvm.html" >Libvirt and KVM</a>
		  </li>
		  
		  <li>
		    <a href="/__new__/2012/06/10/__new__-python.html" >__new__() in python</a>
		  </li>
		  
		  <li>
		    <a href="/kwargs/2012/06/03/understanding-args-and-kwargs.html" >Understanding '*', '*args', '**' and '**kwargs'</a>
		  </li>
		  
		  <li>
		    <a href="/provisioning/2012/05/29/provisioning-made-easy-with-chef.html" >Provisioning Made Easy With Chef</a>
		  </li>
		  
		  <li>
		    <a href="/development/2012/05/02/test-driven-development-python.html" >Test Driven Development in Python </a>
		  </li>
		  
		  <li>
		    <a href="/terminal/2012/03/20/developing-android-applications-from-command-line.html" >Developing android applications from command line</a>
		  </li>
		  
		  <li>
		    <a href="/vps/2012/02/23/deploy-django-app-5-easy-steps.html" >Deploy Django App in 5 Easy Steps</a>
		  </li>
		  
		  <li>
		    <a href="/django/2012/02/22/deploying-django-apps-on-heroku.html" >Deploying Django apps on Heroku</a>
		  </li>
		  
		  <li>
		    <a href="/site_id/prefix/2012/02/05/dynamically-attaching-site_id-django-caching.html" > Dynamically attaching SITE_ID to Django Caching</a>
		  </li>
		  
		  <li>
		    <a href="/django/2012/02/04/deploying-django-apps-on-heroku-2.html" >Deploying Django apps on Heroku</a>
		  </li>
		  
		  <li>
		    <a href="/screencasts/2012/02/03/how-to-use-pep8py-to-write-better-django-code.html" >How to use pep8.py to write better Django code</a>
		  </li>
		  
		  <li>
		    <a href="/screencasts/2012/02/02/how-and-why-to-use-pyflakes-to-write-better-python.html" >How and why to use pyflakes to write better Python</a>
		  </li>
		  
		  <li>
		    <a href="/south/2012/01/09/south.html" >Getting started with South for Django DB migrations</a>
		  </li>
		  
		  <li>
		    <a href="/coffeescript/2012/01/06/writing-jquery-plugins-using-coffeescript.html" >Writing jQuery plugins using Coffeescript</a>
		  </li>
		  
		  <li>
		    <a href="/response/2012/01/02/behind-the-scenes-request-to-response.html" >Request to Response</a>
		  </li>
		  
		  <li>
		    <a href="/java/2011/12/28/using-sqlite-database-with-android.html" >Using SQLite Database with Android</a>
		  </li>
		  
		  <li>
		    <a href="/django/2011/12/25/haml-for-django-developers.html" >Haml for Django developers</a>
		  </li>
		  
		  <li>
		    <a href="/coffeescript/2011/12/24/coffeescript-for-python-programmers.html" >Coffeescript for Python programmers</a>
		  </li>
		  
		  <li>
		    <a href="/treeview/2011/10/12/how-use-jstree.html" >How to use jsTree</a>
		  </li>
		  
		  <li>
		    <a href="/upload/2011/09/21/behind-the-scenes-from-html-form-to-storage.html" >From HTML Form to Storage</a>
		  </li>
		  
		  <li>
		    <a href="/mysql/2011/07/01/setting-your-system-start-django-development-ubunt.html" >Setting up your system to start with Django development on Ubuntu:</a>
		  </li>
		  
		  <li>
		    <a href="/e-mail/2011/04/05/writing-an-e-mail-application-with-lamson-ii.html" >Writing an e-mail application with Lamson - II</a>
		  </li>
		  
		  <li>
		    <a href="/e-mail/2011/04/01/writing-an-e-mail-application-with-lamson-i.html" >Writing an e-mail application with Lamson - I</a>
		  </li>
		  
		  <li>
		    <a href="/jobs/2011/03/15/jobs.html" >Jobs</a>
		  </li>
		  
		  <li>
		    <a href="/java/2011/02/08/comparision-iphone-android-phonegap-titanium.html" >Comparison of mobile app frameworks: Iphone, Java, Phonegap and Titanium</a>
		  </li>
		  
		  <li>
		    <a href="/iphone/2011/02/08/getting-started-with-titanium-development.html" >Getting started with Titanium development for Android and Iphone</a>
		  </li>
		  
		  <li>
		    <a href="/android/2011/02/06/getting-started-with-phonegap-using-xcode-for-mobi.html" >Getting started with PhoneGap using Xcode for Mobile app development</a>
		  </li>
		  
		  <li>
		    <a href="/java/2011/02/06/starting-android-app-developement-from-zero-to-app.html" >Starting Android app developement: From zero to app</a>
		  </li>
		  
		  <li>
		    <a href="/mobile/applications/2011/02/03/iphoneandroid-application-development-using-titani.html" >iPhone and Android application development using Titanium</a>
		  </li>
		  
		  <li>
		    <a href="/linkroundup/2011/01/21/link-roundup-10.html" >Link roundup 10</a>
		  </li>
		  
		  <li>
		    <a href="/linkroundup/2011/01/07/link-roundup-9.html" >Link roundup 9</a>
		  </li>
		  
		  <li>
		    <a href="/reviews/2010/12/31/book-review-the-principles-of-beautiful-web-design.html" >Book Review: The Principles Of Beautiful Web Design</a>
		  </li>
		  
		  <li>
		    <a href="/linkroundup/2010/12/31/link-roundup-8.html" >Link roundup 8</a>
		  </li>
		  
		  <li>
		    <a href="/emacs/2010/12/27/django-emacs-setup.html" >Django emacs setup</a>
		  </li>
		  
		  <li>
		    <a href="/reviews/2010/12/26/book-review-pragmatic-guide-to-javascript.html" >Book Review: Pragmatic Guide to JavaScript</a>
		  </li>
		  
		  <li>
		    <a href="/reviews/2010/12/25/the-principles-of-successful-freelancing.html" >Book review: The Principles of Successful Freelancing</a>
		  </li>
		  
		  <li>
		    <a href="/reviews/2010/12/24/book-review-the-principles-of-project-management.html" >Book review: The Principles of Project Management</a>
		  </li>
		  
		  <li>
		    <a href="/reviews/2010/12/24/book-review-outsourcing-web-projects.html" >Book Review: Outsourcing Web Projects.</a>
		  </li>
		  
		  <li>
		    <a href="/linkroundup/2010/12/23/link-roundup-for-week-ending-24122010.html" >Link roundup for week ending 24/12/2010</a>
		  </li>
		  
		  <li>
		    <a href="/%0A2010-12-22-real-time-applications-with-django-xmpp-and-stroph.markdown/xmpp/2010/12/22/real-time-applications-with-django-xmpp-and-stroph.html" >Real time applications with Django, XMPP and StropheJS</a>
		  </li>
		  
		  <li>
		    <a href="/tips/2010/12/04/the-unfuddle-tutorial.html" >The Unfuddle Tutorial</a>
		  </li>
		  
		  <li>
		    <a href="/apps/2010/12/04/experiments-in-url-design.html" >Experiments in URL design.</a>
		  </li>
		  
		  <li>
		    <a href="/linkroundup/2010/11/26/link-roundup-for-week-ending-26112010.html" >Link roundup for week ending 26/11/2010</a>
		  </li>
		  
		  <li>
		    <a href="/linkroundup/2010/11/19/link-roundup-for-week-ending-19112010.html" >Link Roundup for week ending 19/11/2010</a>
		  </li>
		  
		  <li>
		    <a href="/linkroundup/2010/11/12/link-roundup-for-week-ending-12112010.html" >Link Roundup for week ending 12/11/2010</a>
		  </li>
		  
		  <li>
		    <a href="/python/2010/11/07/i-am-so-starving-same-web-app-in-various-python-we.html" >I am so starving: Web app in python frameworks.</a>
		  </li>
		  
		  <li>
		    <a href="/vim/2010/11/03/seven-reasons-why-you-should-switch-to-vim-for-dja.html" >Seven reasons why you should switch to Vim</a>
		  </li>
		  
		  <li>
		    <a href="/linkroundup/2010/11/03/link-roundup-for-week-ending-5112011.html" >Link Roundup for week ending 5/11/2011</a>
		  </li>
		  
		  <li>
		    <a href="/wordpress/2010/10/28/importing-wordpress.html" >Importing wordpress</a>
		  </li>
		  
		  <li>
		    <a href="/api/2010/10/25/getting-trending-github-projects-via.html" >Getting trending Github projects via YQL</a>
		  </li>
		  
		  <li>
		    <a href="/linkroundup/2010/10/22/link-roundup-for-week-ending-2.html" >Link Roundup for week ending 22/10/2010</a>
		  </li>
		  
		  <li>
		    <a href="/business/2010/10/18/essential-web-apps-to-run-a.html" >Essential web-apps to run a software business.</a>
		  </li>
		  
		  <li>
		    <a href="/opinion/2010/10/17/django-is-not-flexible.html" >Django is not flexible</a>
		  </li>
		  
		  <li>
		    <a href="/linkroundup/2010/10/15/link-roundup-for-week-ending.html" >Link Roundup for week ending 15/10/2010</a>
		  </li>
		  
		  <li>
		    <a href="/about/2010/06/08/moving-home.html" >Moving home</a>
		  </li>
		  
		  <li>
		    <a href="/uncategorized/2010/03/20/rails-and-django-commands-comparison-and-conversio.html" >Rails and Django commands : comparison  and conversion</a>
		  </li>
		  
		  <li>
		    <a href="/rails/2010/03/20/the-rails-and-django-models-layer-rosseta-stone.html" >The Rails and Django models layer Rosseta stone</a>
		  </li>
		  
		  <li>
		    <a href="/models/2010/01/18/doing-things-with-django-models-aka-django-models.html" >Doing things with Django models - aka - Django models tutorial</a>
		  </li>
		  
		  <li>
		    <a href="/about/2010/01/17/wordpress-and-django-best-buddies.html" >Wordpress and Django: best buddies</a>
		  </li>
		  
		  <li>
		    <a href="/tutorial/2010/01/14/doing-things-with-django-forms.html" >Doing things with Django forms</a>
		  </li>
		  
		  <li>
		    <a href="/apps/2010/01/07/django-forum.html" >django-forum</a>
		  </li>
		  
		  <li>
		    <a href="/uncategorized/2009/12/13/django-buzz.html" >Django-buzz</a>
		  </li>
		  
		  <li>
		    <a href="/tutorial/2009/12/12/using-bpython-shell-with-django-and-some-ipython-f.html" >Using bpython shell with django (and some Ipython features you should know)</a>
		  </li>
		  
		  <li>
		    <a href="/india/2009/12/10/fossin-2009-the-best-fossin-ever.html" >Foss.in 2009: The best foss.in. Ever. </a>
		  </li>
		  
		  <li>
		    <a href="/tutorial/2009/12/03/python-metaclasses-and-how-django-uses-them.html" >Python metaclasses and how Django uses them</a>
		  </li>
		  
		  <li>
		    <a href="/django/2009/12/03/django-quiz.html" >Django quiz</a>
		  </li>
		  
		  <li>
		    <a href="/python/2009/11/26/django-for-a-rails-developer.html" >Django for a Rails Developer</a>
		  </li>
		  
		  <li>
		    <a href="/uncategorized/2009/11/21/the-magic-of-metaclasses-in-python.html" >The magic of metaclasses in Python</a>
		  </li>
		  
		  <li>
		    <a href="/tutorial/2009/11/21/writing-your-own-template-loaders.html" >Writing your own template loaders</a>
		  </li>
		  
		  <li>
		    <a href="/tutorial/2009/11/11/django-gotchas.html" >Django gotchas </a>
		  </li>
		  
		  <li>
		    <a href="/uncategorized/2009/10/02/pycon-india-2009-a-review.html" >Pycon India 2009 : A Review</a>
		  </li>
		  
		  <li>
		    <a href="/tutorial/2009/09/18/beginning-python.html" >Beginning python</a>
		  </li>
		  
		  <li>
		    <a href="/yahoo/2009/08/27/django-socialauth-login-via-twitter-facebook-openi.html" >Django-SocialAuth - Login via twitter, facebook, openid, yahoo, google using a single app.</a>
		  </li>
		  
		  <li>
		    <a href="/rambling/2009/08/20/a-response-to-dropping-django.html" >A response to Dropping Django</a>
		  </li>
		  
		  <li>
		    <a href="/aggreagtion/2009/08/18/django-aggregation-tutorial.html" >Django aggregation tutorial</a>
		  </li>
		  
		  <li>
		    <a href="/tips/2009/07/16/on-captcha.html" >On Captcha</a>
		  </li>
		  
		  <li>
		    <a href="/book/2009/07/03/django-design-patterns.html" >Django design patterns</a>
		  </li>
		  
		  <li>
		    <a href="/django/2009/07/02/remote-debugging-debugging-pesky-server-only-bugs.html" >Remote debugging - debugging pesky server only bugs</a>
		  </li>
		  
		  <li>
		    <a href="/django/2009/06/25/django-request-response-processing.html" >Django Request Response processing</a>
		  </li>
		  
		  <li>
		    <a href="/python/2009/06/24/better-python-package-management-using-source-and.html" >Better Python package management using source and version control systems</a>
		  </li>
		  
		  <li>
		    <a href="/python/2009/06/23/understanding-decorators.html" >Understanding decorators</a>
		  </li>
		  
		  <li>
		    <a href="/algorithms/2009/06/16/generating-pseudo-random-text-with-markov-chains-u.html" >Generating pseudo random text with Markov chains using Python</a>
		  </li>
		  
		  <li>
		    <a href="/yahoo/2009/06/14/yahoo-boss-python-api.html" >Yahoo BOSS python api</a>
		  </li>
		  
		  <li>
		    <a href="/api/2009/06/10/python-wrapper-on-bing-api.html" >Python Wrapper on Bing API</a>
		  </li>
		  
		  <li>
		    <a href="/ecommerce/2009/03/31/exploring-authorizenet-payment-gateway-options-and.html" >Exploring Authorize.net Payment Gateway Options and integrating it with django</a>
		  </li>
		  
		  <li>
		    <a href="/satchmo/2009/03/26/create-your-own-online-store-in-few-hours-using-sa.html" >Create your own online store in few hours using satchmo (django)</a>
		  </li>
		  
		  <li>
		    <a href="/pinax/2009/03/18/create-a-new-social-networking-site-in-few-hours-u.html" >Create a new social networking site in few hours using pinax platform (django).</a>
		  </li>
		  
		  <li>
		    <a href="/uncategorized/2009/03/11/uswaretech-whitepapers.html" >Uswaretech whitepapers</a>
		  </li>
		  
		  <li>
		    <a href="/products/2009/03/11/django-subdomains-easily-create-subscription-based.html" >Django-subdomains - Easily create subscription based subdomains enabled webapps</a>
		  </li>
		  
		  <li>
		    <a href="/algorithms/2009/03/09/finding-keywords-using-python.html" >Finding keywords using Python</a>
		  </li>
		  
		  <li>
		    <a href="/business/2009/03/09/web-development-companies-working-with-django.html" >Web development companies working with Django</a>
		  </li>
		  
		  <li>
		    <a href="/presentations/2009/03/08/developing-a-web-application-live-in-15-min-in-dja.html" > Developing a Web Application Live in 15 min, in django framework</a>
		  </li>
		  
		  <li>
		    <a href="/algorithms/2009/03/06/constraint-programming-in-python.html" >Constraint programming in Python</a>
		  </li>
		  
		  <li>
		    <a href="/mysql/2009/03/06/django-with-mysql-and-apache-on-ec2.html" >Django with Mysql and Apache on EC2</a>
		  </li>
		  
		  <li>
		    <a href="/facebook/2009/02/20/how-to-build-a-facebook-app-in-django.html" >How to build a Facebook app in Django</a>
		  </li>
		  
		  <li>
		    <a href="/web2.0/2009/02/19/how-we-built-a-twitter-application.html" >How we built a Twitter Application</a>
		  </li>
		  
		  <li>
		    <a href="/paypal/2008/11/12/using-paypal-with-django.html" >Using Paypal with Django</a>
		  </li>
		  
		  <li>
		    <a href="/tips/2008/10/10/using-subdomains-with-django.html" >Using subdomains with Django</a>
		  </li>
		  
		  <li>
		    <a href="/forms/2008/10/10/dynamic-forms-with-django.html" >Dynamic forms with Django</a>
		  </li>
		  
		  <li>
		    <a href="/tips/2008/10/07/generating-pdfs-with-django.html" >Generating PDFs with Django </a>
		  </li>
		  
		  <li>
		    <a href="/interviews/2008/06/24/an-interview-with-adrian-holovaty-creator-of-djang.html" >An Interview with Adrian Holovaty - Creator of Django</a>
		  </li>
		  
		  <li>
		    <a href="/python/2008/05/30/an-interview-with-jacob-kaplan-moss-creator-of-dja.html" >An Interview with Jacob Kaplan-Moss - Creator of Django</a>
		  </li>
		  
		  <li>
		    <a href="/startup/2008/05/14/an-idea-a-day-a-geographical-wiki.html" >An idea a day - A geographical wiki</a>
		  </li>
		  
		  <li>
		    <a href="/startup/2008/05/13/an-idea-a-day-alternative-to-gae.html" >An idea a day - Alternative to GAE</a>
		  </li>
		  
		  <li>
		    <a href="/startup/2008/05/12/an-idea-a-day-remotely-hosted-analytics-solution.html" >An idea a day - Remotely hosted Analytics solution</a>
		  </li>
		  
		  <li>
		    <a href="/uncategorized/2008/05/12/popularising-django-part-2.html" >Popularising Django - Part 2</a>
		  </li>
		  
		  <li>
		    <a href="/startup/2008/05/11/an-idea-a-day-recomendation-system-based-ad-networ.html" >An idea a day - Recomendation system based ad network</a>
		  </li>
		  
		  <li>
		    <a href="/startup/2008/05/10/an-idea-a-day-an-automated-adwords-optimizer.html" >An idea a day - An automated Adwords optimizer</a>
		  </li>
		  
		  <li>
		    <a href="/search/2008/05/08/parable-of-the-single-sheep-or-how-google-is-destr.html" >Parable of the single sheep - Or How Google is destroying the internet, and nobody seems to know.</a>
		  </li>
		  
		  <li>
		    <a href="/marketing/2008/05/06/an-interview-with-michael-trier.html" >An interview with Michael Trier</a>
		  </li>
		  
		  <li>
		    <a href="/marketing/2008/05/06/popularizing-django-or-reusable-apps-considered-ha.html" >Popularizing Django -- Or Reusable apps considered harmful.</a>
		  </li>
		  
		  <li>
		    <a href="/interviews/2008/04/27/interview-with-james-bennett-django-release-manage.html" >Interview with James Bennett - Django release manager</a>
		  </li>
		  
		  <li>
		    <a href="/search/2008/04/22/parable-of-the-nofollow.html" >Parable of the nofollow</a>
		  </li>
		  
		  <li>
		    <a href="/startup/2008/04/22/why-people-start-startups.html" >Why people start startups.</a>
		  </li>
		  
		  <li>
		    <a href="/marketing/2008/04/21/marketing-lessons-from-google.html" >Marketing lessons from Google</a>
		  </li>
		  
		  <li>
		    <a href="/python/2008/04/18/five-things-i-hate-about-django.html" >Five Things I Hate About Django.</a>
		  </li>
		  
		  <li>
		    <a href="/startup/2008/04/12/first-step-to-startup-getting-your-pitch.html" >First step to startup - Getting your pitch</a>
		  </li>
		  
		  <li>
		    <a href="/python/2008/04/11/two-djangoappengine-tutorials.html" >Two Django+Appengine Tutorials</a>
		  </li>
		  
		  <li>
		    <a href="/python/2008/04/09/using-appengine-with-django-why-it-is-pretty-much.html" >Using Appengine with Django, why it is pretty much unusable</a>
		  </li>
		  
		  <li>
		    <a href="/python/2008/04/09/google-appengine-first-impressions.html" >Google Appengine - First Impressions</a>
		  </li>
		  
		</ul>
        </div>
        
        
        
      </section>
      <div id="content">
     	<p>This post tries to clear various concepts related to Django timezones. Settings relevant to timezone are TIME_ZONE and USE_TZ. We will see various scenarios with different values for these settings and will figure out how TIME_ZONE and USE_TZ behave.</p>

<p>Once through this post, you will stop playing guessing games with Django timezones.</p>

<p>I will use sqlite throughout this post.</p>

<p>I assume that you understand the general concept of timezone. If not then see the <a href="#concept_timezone">section at bottom</a> before you read further.</p>

<h3 id="installing_pytz">Installing pytz</h3>

<p>Working with timezones is much easier if you have pytz installed. Django recommends using it too.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install pytz
</code></pre></div></div>

<h3 id="naive-and-aware-datetimes">Naive and aware datetimes</h3>

<p>Before you can understand Django timezones, it’s important to understand naive and aware datetimes.</p>

<h4 id="naive-datetime">Naive datetime</h4>
<p>Suppose you schedule a Google hangout for 28 July, 6:30 PM with someone. You do not give any timezone information. That person has no way to know if you mean 6:30 PM in India or 6:30 PM in USA. This 6:30 PM is open to interpretation. It is a naive datetime.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; dt = datetime.now()
&gt;&gt;&gt; dt
datetime.datetime(2014, 7, 29, 12, 55, 20, 672052)
&gt;&gt;&gt; print dt.tzinfo
None                  #This prints None.
</code></pre></div></div>

<p>You can check <strong>tzinfo</strong> attribute on a datetime instance to know if the datetime instance in naive or aware. If <code class="highlighter-rouge">tzinfo</code> in None, then it is a naive datetime.</p>

<p>Also <strong>dt</strong> would be same as your computer’s time. Check it using <strong>date</strong> command on a new terminal. Though system’s datetime has a timezone info associated with current time, Python’s datetime.now() doesn’t give the timezone information by default.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ $ date
Tue Jul 29 12:55:22 IST 2014
</code></pre></div></div>

<h4 id="aware-datetime">Aware datetime</h4>
<p>If you say 3:30 AM New York time, it is an aware datetime. This 3:30 AM is not open to interpretation.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; import pytz
&gt;&gt;&gt; tz = pytz.timezone('America/New_York')
&gt;&gt;&gt; new_york_dt = datetime.now(tz) # We pass timezone instance to now()
&gt;&gt;&gt; new_york_dt
datetime.datetime(2014, 7, 29, 3, 43, 58, 507746, tzinfo=&lt;DstTzInfo 'America/New_York' EDT-1 day, 20:00:00 DST&gt;)
&gt;&gt;&gt; print new_york_dt.tzinfo
America/New_York
</code></pre></div></div>

<p>As you can see <code class="highlighter-rouge">tzinfo</code> attribute is set on the datetime instance if we pass a pytz.timezone instance to datetime.now(). Here <strong>new_york_dt</strong> is an aware datetime instance.</p>

<p>You can read <a href="https://docs.python.org/2/library/datetime.html" target="_blank">Python docs on datetime</a> to know more about naive and aware datetimes.</p>

<h3 id="setting-up-the-project">Setting up the project</h3>

<p>I will try everything inside a virtual environment. My virtualenv is named django_timezone and path is /tmp.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(django_timezone)/tmp $ django-admin.py startproject tz
</code></pre></div></div>

<p>I am using Django 1.6.5. Let’s will install pytz too.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(django_timezone)/tmp/tz $ pip install pytz
</code></pre></div></div>

<p>Django timezone behaviour depends on settings.USE_TZ and settings.TIME_ZONE. Their default values are:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TIME_ZONE = 'UTC'
USE_TZ = True
</code></pre></div></div>

<p>We need a DateTime field to go through various scenarios. Create an app which will contain a model with a DateTimeField</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(django_timezone)/tmp/tz $ python manage.py startapp article
</code></pre></div></div>

<p>In article/models.py</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Article(models.Model):
	description = models.TextField()
	publish_date = models.DateTimeField()
</code></pre></div></div>

<p>Run syncdb, make sure to add ‘article’ to INSTALLED_APPS. Make sure to register Article in admin.</p>

<h3 id="using-datetimenow-from-shell">Using datetime.now() from shell</h3>

<p>At this point, we have the following settings</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TIME_ZONE = 'UTC'
USE_TZ = True
</code></pre></div></div>

<p>Start a shell.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(django_timezone)/private/tmp/tz $ python manage.py shell

&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; dt = datetime.now()
&gt;&gt;&gt; print dt
2014-07-29 09:52:33.417034
</code></pre></div></div>

<p>I am in India at GMT+05:30 and right now it is 3:22 PM in India. But now() tells me it’s 09:52 AM which is 5 hours 30 minutes behind India’s time. now() is telling the UTC time. And TIME_ZONE is set as ‘UTC’. So, now() uses TIME_ZONE to tell time. But this datetime <code class="highlighter-rouge">dt</code> is naive, as you can verify by printing dt.tzinfo.</p>

<h4 id="make-use_tz--false">Make USE_TZ = False</h4>

<p>Make sure to set settings.USE_TZ=False</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; dt = datetime.now()
&gt;&gt;&gt; print dt
2014-07-29 09:55:49.481732
</code></pre></div></div>

<p>now() still gives the UTC time. And <code class="highlighter-rouge">dt</code> is naive as can be verified by printing <code class="highlighter-rouge">dt.tzinfo</code>.</p>

<p>This verifies datetime.now() is independent of settings.USE_TZ.</p>

<p>It seems it depends on TIME_ZONE. Let’s change settings.TIME_ZONE to ‘America/New_York’ and see if output of now() differs. New York is at UTC-04:00. So now() should start saying 05:55 AM.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>settings.TIME_ZONE = 'America/New_York'
</code></pre></div></div>

<p>Restart the shell and invoke now()</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; dt = datetime.now()
&gt;&gt;&gt; print dt
2014-07-29 05:58:27.056390
</code></pre></div></div>

<p>now() tells the current time of New York. This verifies that datetime.now() is dependent on TIME_ZONE. Though this datetime is naive too; verify using dt.tzinfo.</p>

<p>Reset TIME_ZONE to ‘UTC’ and USE_TZ to True.</p>

<h3 id="using-djangoutilstimezonenow">Using django.utils.timezone.now()</h3>

<p><strong>Edit</strong>: The striked out lines is what I wrote earlier, but the good folks on reddit corrected me.</p>

<p><del>It behaves similar to datetime.now() with one difference. Where datetime.now() always gives naive datetime object, this gives a naive or aware datetime object depending on value of USE_TZ.</del></p>

<p>It always returns UTC time. It is not dependent on settings.TIME_ZONE. It gives a native or aware datetime object depending on values of settings.USE_TZ</p>

<h4 id="when-use_tz-is-true">When USE_TZ is True</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; from django.utils.timezone import now
&gt;&gt;&gt; dt = now()
&gt;&gt;&gt; dt
datetime.datetime(2014, 7, 29, 10, 22, 24, 163837, tzinfo=&lt;UTC&gt;)
&gt;&gt;&gt; print dt.tzinfo
UTC
</code></pre></div></div>

<p><del>This gives the UTC time because we have TIME_ZONE set to UTC. This behaviour is similar to datetime.now(). But in addition, the datetime object also has tzinfo attribute set on it and so it is an aware datetime object.</del></p>

<p>We got an aware datetime object and time is represented in UTC.</p>

<h5 id="verifying-that-timezonenow-doesnt-depend-on-time_zone">Verifying that timezone.now() doesn’t depend on TIME_ZONE</h5>

<p>Change settings.TIME_ZONE</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TIME_ZONE = 'Asia/Kolkata'
</code></pre></div></div>

<p>Restart the shell and use timezone.now()</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; from django.utils.timezone import now
&gt;&gt;&gt; dt = now()
&gt;&gt;&gt; dt
datetime.datetime(2014, 7, 29, 10, 23, 24, 163837, tzinfo=&lt;UTC&gt;)
&gt;&gt;&gt; print dt.tzinfo
UTC
</code></pre></div></div>

<p>So even though we set timezone as ‘Asia/Kolkata’, now() returns UTC time.</p>

<h4 id="when-use_tz-is-false">When USE_TZ is False</h4>

<p>Make sure to change settings.USE_TZ=False</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; from django.utils.timezone import now
&gt;&gt;&gt; dt = now()
&gt;&gt;&gt; dt
datetime.datetime(2014, 7, 29, 10, 28, 10, 353942)
&gt;&gt;&gt; print dt.tzinfo
None
</code></pre></div></div>

<p>This behaviour is exactly similar to datetime.now(). You get the time in same timezone as settings.TIME_ZONE, and it is a naive datetime.</p>

<p>Reset USE_TZ to True.</p>

<h3 id="before-we-proceed">Before we proceed</h3>

<p>When we say timezone support is enabled, it means USE_TZ = True. When we say timezone support is disabled, it means USE_TZ = False.</p>

<h3 id="how-articlepublish_date-behaves-in-form">How Article.publish_date behaves in form</h3>

<p>Let’s first consider the scenario where timezone is enabled.</p>

<h4 id="timezone-is-enabled-ie-use_tztrue">Timezone is enabled, i.e USE_TZ=True</h4>

<p>Go to article creation page <a href="http://localhost:8000/admin/article/article/add/" target="_blank">http://localhost:8000/admin/article/article/add/</a></p>

<p>We are concerned with publish_date. If you click on <strong>Today</strong>, it will enter the date taken from your system time. When you click on <strong>Now</strong>, it will enter the time taken from your system time. <code class="highlighter-rouge">Today</code> and <code class="highlighter-rouge">Now</code> work using Javascript, and Javascript doesn’t have any idea of Django TIME_ZONE and USE_TZ. Javascript only has access to your system time. That’s why <code class="highlighter-rouge">Today</code> and <code class="highlighter-rouge">Now</code> will take the value from your system’s time irrespective of Django TIME_ZONE and USE_TZ values.</p>

<p>I am in <strong>India which is at UTC+05:30</strong>, and it is <strong>4:13 PM</strong> for me. Clicking on <code class="highlighter-rouge">Now</code> puts 4:13 PM in my text field, even though I have TIME_ZONE=’UTC’. In <strong>‘UTC’, it is 10:43 AM (4:13 PM - 5 hours 30 minutes) right now</strong>. Even though TIME_ZONE is set to ‘UTC’, clicking on <code class="highlighter-rouge">Now</code> uses my system time, because Javascript doesn’t have a knowledge of settings.TIME_ZONE</p>

<p>Save the article. Check the value of publish_date saved in db.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; article = Article.objects.get()
&gt;&gt;&gt; article.publish_date
datetime.datetime(2014, 7, 29, 16, 13, 28, tzinfo=&lt;UTC&gt;)
</code></pre></div></div>

<p>So Django tells that publish_date is a timezone aware object with publish_date being shown as 4:13 PM, UTC. This is a bug, we will see an implication of this bug soon. When I submitted the form, I submitted with the assumption that I am submitting time in India timezone. I expect publish_date to say 4:13 PM, India time(hereafter referred as IST). Or it should say 10:43 AM, UTC. We will see how such scenario should be handled and fix this bug later on in this post.</p>

<h5 id="check-how-is-it-saved-in-db">Check how is it saved in db.</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python manage.py dbshell

sqlite&gt; select * from article_article;
1|First Article|2014-07-29 16:13:28
</code></pre></div></div>

<p>It only tells the time and doesn’t tell anything about timezone. So, db doesn’t save timezone information. Django puts a timezone info on datetime instance based on TIME_ZONE. That’s why we saw article.publish_date in ‘UTC’ timezone.</p>

<p><strong>Note:</strong> Postgres can save timezone information too. But we will not worry about it in this post.</p>

<h5 id="what-happened-when-i-submitted-publish_date-from-browser">What happened when I submitted publish_date from browser</h5>

<ul>
  <li>Browser submitted 4:16 PM to server.</li>
  <li>Browser did not submit any timezone info.</li>
  <li>Django saves 4:16 PM in db without any timezone info</li>
  <li>When getting publish date of Article, Django gets 4:16 PM from db, without any timezone info.</li>
  <li>In addition, Django checks value of TIME_ZONE and so adds tzinfo attribute on publish_date and makes it timezone aware.</li>
</ul>

<h4 id="timezone-is-disabled-ie-use_tzfalse">Timezone is disabled, i.e USE_TZ=False</h4>

<p>Make sure to modify settings.USE_TZ=False</p>

<p>Go to article creation page <a href="http://localhost:8000/admin/article/article/add/" target="_blank">http://localhost:8000/admin/article/article/add/</a></p>

<p>You will still see <code class="highlighter-rouge">Today</code> and <code class="highlighter-rouge">Now</code> buttons picking up the system time. They are in no way dependent on TIME_ZONE and USE_TZ.</p>

<p>Create an article from the admin. And then get it and print its publish_date.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; article = Article.objects.get(id=2)
&gt;&gt;&gt; article.publish_date
datetime.datetime(2014, 7, 30, 15, 37, 18)
</code></pre></div></div>

<p>We get a naive datetime object in this scenario. Django didn’t add any tzinfo attribute on datetime instance after fetching it from db.</p>

<p>Reset USE_TZ to True.</p>

<h3 id="implication-of-the-bug">Implication of the bug</h3>

<p>Suppose your project is used by publishers in many countries. Project’s TIME_ZONE is set to ‘UTC’. I am a publisher from India. When I use admin form, I submit date and time in IST. Consider the last article I created. I created the article with publish_date as 3:37 PM, 30th July. My intention was 3:37 PM IST. I expect that article will be shown on the site after 3:37 PM IST.</p>

<p>But Django when getting this article from db considers the publish_date as 3:37 PM UTC, because settings.TIME_ZONE is UTC.</p>

<p>Placeholder code for view which shows articles.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.utils.timezone import now
current_time = now()
Article.objects.filter(publish_date__lte=current_time)
</code></pre></div></div>

<p>When it is 3:38 PM IST, I expect my article to appear on site. But it won’t because when it is 3:38 PM IST, django.utils.timezone.now() will say 10:08 AM UTC. And publish_date is 3:37 PM UTC as per Django, so the filter() will not get my article.</p>

<h3 id="fix-for-this">Fix for this</h3>

<p>Django has a concept of <a href="https://docs.djangoproject.com/en/1.6/topics/i18n/timezones/#default-time-zone-and-current-time-zone">default and current timezone.</a></p>

<h4 id="default-timezone-and-current-timezone">Default timezone and current timezone</h4>

<p>Default timezone is the timezone defined by settings.TIME_ZONE.</p>

<p>Django documentation says, current timezone is the timezone used for rendering. It has an additional purpose and it can fix our buggy scenario.</p>

<h5 id="additional-purpose">Additional purpose</h5>

<p>We can say to Django that current timezone is IST. So, when we submit a form, date and time we pass will be considered in IST and then will be converted to default timezone(UTC) and will then be saved in the database.</p>

<p>Supposing current timezone is set to IST.</p>

<ul>
  <li>I post 3:37 PM.</li>
  <li>Current timezone is set to IST, we will see how to set current timezone soon.</li>
  <li>Django will know I mean 3:37 PM, IST.</li>
  <li>Django will convert 3:37 PM, IST to UTC(because default timezone for project is UTC)</li>
  <li>And will save converted UTC time in db. Converted UTC time would be 10:07 AM.</li>
  <li>And our filter condition will work properly.</li>
</ul>

<h4 id="setting-current-timezone">Setting current timezone</h4>

<p>This can be done using django.utils.timezone.activate</p>

<p>Django <a href="https://docs.djangoproject.com/en/1.6/topics/i18n/timezones/#selecting-the-current-time-zone" target="_blank">example</a> uses session and middleware to set timezone. We will use middleware too but instead of bothering with sessions to keep track of user’s timezone, I will hardcode the current timezone.</p>

<p>Let’s add a file article/middleware.py with following content:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import pytz

from django.utils.timezone import activate

class TimezoneMiddleware(object):
	def process_request(self, request):
		activate(pytz.timezone('Asia/Kolkata'))
</code></pre></div></div>

<p>Using <code class="highlighter-rouge">activate()</code> sets the current timezone. With our middleware, <strong>current timezone is set to IST</strong>. Since we are using a middleware, current timezone will be set in every request.</p>

<p>Add this middleware to settings.MIDDLEWARE_CLASSES:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MIDDLEWARE_CLASSES = (
	'article.middleware.TimezoneMiddleware',
	'django.contrib.sessions.middleware.SessionMiddleware',
	'django.middleware.common.CommonMiddleware',
	'django.middleware.csrf.CsrfViewMiddleware',
	'django.contrib.auth.middleware.AuthenticationMiddleware',
	'django.contrib.messages.middleware.MessageMiddleware',
	'django.middleware.clickjacking.XFrameOptionsMiddleware',
)
</code></pre></div></div>

<p>Visit Article add page in admin.</p>

<p>Enter ‘Date’ for Publish date as ‘2014-07-30’ and ‘Time’ as ‘15:37:08’. Click ‘Save’.</p>

<h4 id="verify-how-is-it-saved-in-db">Verify how is it saved in db:</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlite&gt; select * from article_article where id=3;
3|Third article|2014-07-30 10:07:18
</code></pre></div></div>

<p>So, time we submitted was converted to UTC from IST and then saved to db.</p>

<h5 id="why">Why?</h5>
<ul>
  <li>We submitted 15:37:08 as time.</li>
  <li>Middleware ran and set the current timezone as IST.</li>
  <li>Django assumed that the time we submitted was in IST because current timezone was set to IST.</li>
  <li>Django sees values of TIME_ZONE which is UTC. So it converted the time to UTC and then saved in db.</li>
</ul>

<h4 id="check-how-is-it-shown-in-admin">Check how is it shown in admin.</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>See &lt;a href="http://localhost:8000/admin/article/article/3/" target="_blank"&gt;article 3 details&lt;/a&gt;
</code></pre></div></div>

<p>Publish Time gets shown as ‘15:37:18’. This is because middleware runs on every request. And our middleware sets the current timezone to IST. So, whatever our site gets from db, is converted to IST and then shown to us, which is perfect.</p>

<h4 id="check-how-is-it-shown-on-shell">Check how is it shown on shell.</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(django_timezone)/private/tmp/tz $ python manage.py shell
&gt;&gt;&gt; article = Article.objects.get(id=3)
&gt;&gt;&gt; article.publish_date
datetime.datetime(2014, 7, 30, 10, 7, 18, tzinfo=&lt;UTC&gt;)
</code></pre></div></div>

<p>Django gets the time from db. In db, time is saved as 10:07:18. Django reads the value of TIME_ZONE and sets the TIME_ZONE as tzinfo attribute on datetime object.</p>

<h3 id="can-current-timezone-work-if-timezone-is-not-activated">Can current timezone work if timezone is not activated</h3>

<p>Set USE_TZ to False.</p>

<p>Create a new Article from admin.</p>

<p>Set Publish date as 2014-07-30, and publish time as 15:37:18. Save it.</p>

<h4 id="check-how-is-it-saved-in-db-1">Check how is it saved in db.</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlite&gt; select * from article_article where id=4;
4|Fourth article|2014-07-30 15:37:18
</code></pre></div></div>

<p>So, even though our code tries to set current timezone through middleware, current timezone wasn’t set because we have timezone support disabled.</p>

<p>Django didn’t convert our IST time to UTC before saving to db.</p>

<h4 id="how-is-it-shown-on-shell">How is it shown on shell</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; article = Article.objects.get(id=4)
&gt;&gt;&gt; article.publish_date
datetime.datetime(2014, 7, 30, 15, 37, 18, tzinfo=&lt;UTC&gt;)
</code></pre></div></div>

<h4 id="view-the-article-4-details-in-admin">View the Article 4 details in admin.</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://localhost:8000/admin/article/article/4/
</code></pre></div></div>

<p>Admin shows the publish time same as what was saved in db. No conversion between timezones was done.</p>

<p>Reset USE_TZ to True.</p>

<h3 id="notes">Notes</h3>

<ul>
  <li>USE_TZ=True means timezone support is enabled, USE_TZ=False means timezone is not enabled.</li>
  <li>TIME_ZONE determines in what timezone datetime.now and django.utils.timezone.now return you the time.</li>
  <li>datetime.now always gives naive datetime objects.</li>
  <li>django.utils.timezone.now gives naive datetime objects if timezone support is not enabled, and gives aware objects if timezone support is enabled.</li>
  <li>Current timezone is set using <code class="highlighter-rouge">django.utils.timezone.activate</code>.</li>
  <li>Current timezone activation works only if timezone support is enabled, i.e USE_TZ should be True.</li>
  <li>When current timezone is enabled, Django converts the datetime you POST into settings.TIME_ZONE and then saves this converted datetime in database.</li>
  <li>With current timezone enabled, Django converts the datetime it fetches from db into current timezone. Datetime instances with current timezone is displayed in the user facing forms.</li>
</ul>

<h3 id="concept_timezone">Concept of timezone</h3>
<p>Every country is at a different position on Earth and all countries do not face the Sun at the same instant. India and United States are almost on opposite sides of each other on Earth. When India faces the Sun, USA doesn’t face it. At that instant, it is light(day) in India and dark(night) in USA. Earth rotates on its axis. So after few hours, USA would face the Sun and India wouldn’t face it.</p>

<p>People want the clock to show between 6 AM to 6 PM during the day and between 6 PM to 6 AM during night. People in India have their clocks set such that it says between 6 AM to 6 PM when India faces the Sun. At the same instant, USA doesn’t face Sun and it is dark there; so people in US have their clocks set such that it shows a time between 6 PM to 6 AM. USA and Indian clocks show different time at the same instant.</p>

<p>But India and USA aren’t mathematical terms. There should be a way to know what time is it exactly in USA when it is 6:30 PM, 28 July in India. So we need to know how many hours we need to add or subtract to this time to get the time in USA. This is where timezones come into picture.</p>

<p>There is a reference place on Earth relative to which time on other places is calculated. That place is Greenwich. And its timezone is conventionally called GMT + 0:00. GMT and UTC can be used interchangeably. So Greenwich’s timezone is GMT+00:00 or UTC+00:00. India’s timezone is GMT+05:30 or UTC+05:30. When it is 8:00 AM in Greenwich, it is 1:30 PM in India. New York’s timezone is GMT-04:00 during summer. So when it is 8:00 AM in Greenwich, it is 4:00 AM in New York.</p>

<p>Whole explanation of timezone is outside the scope of this blog. Read <a href="http://en.wikipedia.org/wiki/Time_zone" target="_blank">about in on Wikipedia</a> to know more.</p>

<p><a href="#installing_pytz">Resume at top</a></p>


       </div>
    </div>

    
  </body>
</html>

